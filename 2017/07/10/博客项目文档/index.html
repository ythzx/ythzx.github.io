<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>django博客项目 | Peter&#39;s Blog Center</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="Django" />
  
  
  
  
  <meta name="description" content="Django博客项目配置静态文件">
<meta property="og:type" content="article">
<meta property="og:title" content="Django博客项目">
<meta property="og:url" content="https://github.com/ythzx/ythzx.github.io/2017/07/10/博客项目文档/index.html">
<meta property="og:site_name" content="Peter's Blog Center">
<meta property="og:description" content="Django博客项目配置静态文件">
<meta property="og:image" content="http://images2015.cnblogs.com/blog/658994/201707/658994-20170711160152556-1014780662.jpg">
<meta property="og:image" content="http://images2015.cnblogs.com/blog/658994/201707/658994-20170714195708868-1114842692.jpg">
<meta property="og:image" content="http://images2015.cnblogs.com/blog/658994/201707/658994-20170718155631208-2117733180.jpg">
<meta property="og:image" content="http://images2015.cnblogs.com/blog/658994/201707/658994-20170718155031521-882545890.jpg">
<meta property="og:image" content="http://images2015.cnblogs.com/blog/658994/201707/658994-20170718165552365-358696163.jpg">
<meta property="og:updated_time" content="2017-07-20T11:42:27.548Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Django博客项目">
<meta name="twitter:description" content="Django博客项目配置静态文件">
<meta name="twitter:image" content="http://images2015.cnblogs.com/blog/658994/201707/658994-20170711160152556-1014780662.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Peter&#39;s Blog Center" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >
  <link rel="stylesheet" href="/css/hiero.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Peter&#39;s Blog Center" rel="home"> Peter&#39;s Blog Center </a>
            
          </h1>

          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">首页</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">归档</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/categories">分类</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">标签</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">关于</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>




  <div id="container" style='background: rgba(255,255,255,0.5);'>
    <div id="wrap" style='background: rgba(255,255,255,0.5);'>
            
      <div id="content" class="outer" style='background: rgba(255,255,255,0.5);'>
        
          <section id="main" style="float:none;"><article id="post-博客项目文档" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Django博客项目
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2017/07/10/博客项目文档/" class="article-date">
	  <time datetime="2017-07-10T08:53:47.092Z" itemprop="datePublished">七月 10, 2017</time>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Django博客项目"><a href="#Django博客项目" class="headerlink" title="Django博客项目"></a>Django博客项目</h1><h2 id="配置静态文件"><a href="#配置静态文件" class="headerlink" title="配置静态文件"></a>配置静态文件</h2><a id="more"></a>
<p>setting中添加<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">STATICFILES_DIRS =(</div><div class="line">    os.path.join(BASE_DIR,<span class="string">'static'</span>),</div><div class="line">)</div></pre></td></tr></table></figure></p>
<h2 id="数据库MySQL"><a href="#数据库MySQL" class="headerlink" title="数据库MySQL"></a>数据库MySQL</h2><h3 id="配置setting"><a href="#配置setting" class="headerlink" title="配置setting"></a>配置setting</h3><p>前提是新建数据库blog<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">DATABASES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'blog'</span>,</div><div class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</div><div class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'871577942@mysql'</span>,</div><div class="line">        <span class="string">'HOST'</span>: <span class="string">'localhost'</span>,</div><div class="line">        <span class="string">'PORT'</span>: <span class="number">3306</span>,</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="配置成pymysql进行连接及MySQL"><a href="#配置成pymysql进行连接及MySQL" class="headerlink" title="配置成pymysql进行连接及MySQL"></a>配置成pymysql进行连接及MySQL</h3><p>在app01中的的<strong>init</strong>中<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pymysql</div><div class="line">pymysql.install_as_MySQLdb()</div></pre></td></tr></table></figure></p>
<h2 id="models-设计表的结构"><a href="#models-设计表的结构" class="headerlink" title="models 设计表的结构"></a>models 设计表的结构</h2><h3 id="在modles中创建"><a href="#在modles中创建" class="headerlink" title="在modles中创建"></a>在modles中创建</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    用户表</div><div class="line">    """</div><div class="line">    nid = models.BigAutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">    username = models.CharField(verbose_name=<span class="string">'用户名'</span>, max_length=<span class="number">32</span>, unique=<span class="keyword">True</span>)</div><div class="line">    password = models.CharField(verbose_name=<span class="string">'密码'</span>, max_length=<span class="number">64</span>)</div><div class="line">    nickname = models.CharField(verbose_name=<span class="string">'昵称'</span>, max_length=<span class="number">32</span>)</div><div class="line">    email = models.EmailField(verbose_name=<span class="string">'邮箱'</span>, unique=<span class="keyword">True</span>)</div><div class="line">    avatar = models.ImageField(verbose_name=<span class="string">'头像'</span>)</div><div class="line"></div><div class="line">    create_time = models.DateTimeField(verbose_name=<span class="string">'创建时间'</span>, auto_now_add=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">    fans = models.ManyToManyField(verbose_name=<span class="string">'粉丝们'</span>,</div><div class="line">                                  to=<span class="string">'UserInfo'</span>,</div><div class="line">                                  through=<span class="string">'UserFans'</span>,</div><div class="line">                                  related_name=<span class="string">'f'</span>,</div><div class="line">                                  through_fields=(<span class="string">'user'</span>, <span class="string">'follower'</span>))</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Blog</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    博客信息</div><div class="line">    """</div><div class="line">    nid = models.BigAutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">    title = models.CharField(verbose_name=<span class="string">'个人博客标题'</span>, max_length=<span class="number">64</span>)</div><div class="line">    site = models.CharField(verbose_name=<span class="string">'个人博客前缀'</span>, max_length=<span class="number">32</span>, unique=<span class="keyword">True</span>)</div><div class="line">    theme = models.CharField(verbose_name=<span class="string">'博客主题'</span>, max_length=<span class="number">32</span>)</div><div class="line">    user = models.OneToOneField(to=<span class="string">'UserInfo'</span>, to_field=<span class="string">'nid'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserFans</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    互粉关系表</div><div class="line">    """</div><div class="line">    user = models.ForeignKey(verbose_name=<span class="string">'博主'</span>, to=<span class="string">'UserInfo'</span>, to_field=<span class="string">'nid'</span>, related_name=<span class="string">'users'</span>)</div><div class="line">    follower = models.ForeignKey(verbose_name=<span class="string">'粉丝'</span>, to=<span class="string">'UserInfo'</span>, to_field=<span class="string">'nid'</span>, related_name=<span class="string">'followers'</span>)</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        unique_together = [</div><div class="line">            (<span class="string">'user'</span>, <span class="string">'follower'</span>),</div><div class="line">        ]</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    博主个人文章分类表</div><div class="line">    """</div><div class="line">    nid = models.AutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">    title = models.CharField(verbose_name=<span class="string">'分类标题'</span>, max_length=<span class="number">32</span>)</div><div class="line"></div><div class="line">    blog = models.ForeignKey(verbose_name=<span class="string">'所属博客'</span>, to=<span class="string">'Blog'</span>, to_field=<span class="string">'nid'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleDetail</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    文章详细表</div><div class="line">    """</div><div class="line">    content = models.TextField(verbose_name=<span class="string">'文章内容'</span>, )</div><div class="line"></div><div class="line">    article = models.OneToOneField(verbose_name=<span class="string">'所属文章'</span>, to=<span class="string">'Article'</span>, to_field=<span class="string">'nid'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpDown</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    文章顶或踩</div><div class="line">    """</div><div class="line">    article = models.ForeignKey(verbose_name=<span class="string">'文章'</span>, to=<span class="string">'Article'</span>, to_field=<span class="string">'nid'</span>)</div><div class="line">    user = models.ForeignKey(verbose_name=<span class="string">'赞或踩用户'</span>, to=<span class="string">'UserInfo'</span>, to_field=<span class="string">'nid'</span>)</div><div class="line">    up = models.BooleanField(verbose_name=<span class="string">'是否赞'</span>)</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        unique_together = [</div><div class="line">            (<span class="string">'article'</span>, <span class="string">'user'</span>),</div><div class="line">        ]</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    评论表</div><div class="line">    """</div><div class="line">    nid = models.BigAutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">    content = models.CharField(verbose_name=<span class="string">'评论内容'</span>, max_length=<span class="number">255</span>)</div><div class="line">    create_time = models.DateTimeField(verbose_name=<span class="string">'创建时间'</span>, auto_now_add=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">    reply = models.ForeignKey(verbose_name=<span class="string">'回复评论'</span>, to=<span class="string">'self'</span>, related_name=<span class="string">'back'</span>, null=<span class="keyword">True</span>)</div><div class="line">    article = models.ForeignKey(verbose_name=<span class="string">'评论文章'</span>, to=<span class="string">'Article'</span>, to_field=<span class="string">'nid'</span>)</div><div class="line">    user = models.ForeignKey(verbose_name=<span class="string">'评论者'</span>, to=<span class="string">'UserInfo'</span>, to_field=<span class="string">'nid'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tag</span><span class="params">(models.Model)</span>:</span></div><div class="line">    nid = models.AutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">    title = models.CharField(verbose_name=<span class="string">'标签名称'</span>, max_length=<span class="number">32</span>)</div><div class="line">    blog = models.ForeignKey(verbose_name=<span class="string">'所属博客'</span>, to=<span class="string">'Blog'</span>, to_field=<span class="string">'nid'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(models.Model)</span>:</span></div><div class="line">    nid = models.BigAutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">    title = models.CharField(verbose_name=<span class="string">'文章标题'</span>, max_length=<span class="number">128</span>)</div><div class="line">    summary = models.CharField(verbose_name=<span class="string">'文章简介'</span>, max_length=<span class="number">255</span>)</div><div class="line">    read_count = models.IntegerField(default=<span class="number">0</span>)</div><div class="line">    comment_count = models.IntegerField(default=<span class="number">0</span>)</div><div class="line">    up_count = models.IntegerField(default=<span class="number">0</span>)</div><div class="line">    down_count = models.IntegerField(default=<span class="number">0</span>)</div><div class="line">    create_time = models.DateTimeField(verbose_name=<span class="string">'创建时间'</span>, auto_now_add=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">    blog = models.ForeignKey(verbose_name=<span class="string">'所属博客'</span>, to=<span class="string">'Blog'</span>, to_field=<span class="string">'nid'</span>)</div><div class="line">    category = models.ForeignKey(verbose_name=<span class="string">'文章类型'</span>, to=<span class="string">'Category'</span>, to_field=<span class="string">'nid'</span>, null=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">    type_choices = [</div><div class="line">        (<span class="number">1</span>, <span class="string">"Python"</span>),</div><div class="line">        (<span class="number">2</span>, <span class="string">"Linux"</span>),</div><div class="line">        (<span class="number">3</span>, <span class="string">"OpenStack"</span>),</div><div class="line">        (<span class="number">4</span>, <span class="string">"GoLang"</span>),</div><div class="line">    ]</div><div class="line"></div><div class="line">    article_type_id = models.IntegerField(choices=type_choices, default=<span class="keyword">None</span>)</div><div class="line"></div><div class="line">    tags = models.ManyToManyField(</div><div class="line">        to=<span class="string">"Tag"</span>,</div><div class="line">        through=<span class="string">'Article2Tag'</span>,</div><div class="line">        through_fields=(<span class="string">'article'</span>, <span class="string">'tag'</span>),</div><div class="line">    )</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article2Tag</span><span class="params">(models.Model)</span>:</span></div><div class="line">    article = models.ForeignKey(verbose_name=<span class="string">'文章'</span>, to=<span class="string">"Article"</span>, to_field=<span class="string">'nid'</span>)</div><div class="line">    tag = models.ForeignKey(verbose_name=<span class="string">'标签'</span>, to=<span class="string">"Tag"</span>, to_field=<span class="string">'nid'</span>)</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        unique_together = [</div><div class="line">            (<span class="string">'article'</span>, <span class="string">'tag'</span>),</div><div class="line">        ]</div></pre></td></tr></table></figure>
<h3 id="生成表"><a href="#生成表" class="headerlink" title="生成表"></a>生成表</h3><ol>
<li><p>需要pip install pillow ,是ImageField需要</p>
</li>
<li><p>python3 manage.py makemigratons</p>
</li>
<li><p>python3 manage.py migrate</p>
</li>
</ol>
<h2 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h2><h3 id="1-导航条"><a href="#1-导航条" class="headerlink" title="1 导航条"></a>1 导航条</h3><p>使用 Bootstrap的导航条</p>
<h4 id="修改导航条两侧间距"><a href="#修改导航条两侧间距" class="headerlink" title="修改导航条两侧间距"></a>修改导航条两侧间距</h4><p>把<code>&quot;container-fluid&quot;</code>修改成container</p>
<p>内部实现的原理就是设置一个宽度，<code>margin 0，auto</code></p>
<h4 id="修改Bootstrap的整体圆角"><a href="#修改Bootstrap的整体圆角" class="headerlink" title="修改Bootstrap的整体圆角"></a>修改Bootstrap的整体圆角</h4><p>自己写css并导入,使用<code>!important</code>设置优先级</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.no-radius</span>&#123;</div><div class="line">    <span class="attribute">border-radius</span>: <span class="number">0</span> <span class="meta">!important</span>;<span class="comment">/*强制覆盖Bootstrap的样式*/</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="修改导航条的分类"><a href="#修改导航条的分类" class="headerlink" title="修改导航条的分类"></a>修改导航条的分类</h4><p>文章表中有type_choices 的数据，是类中的数据，然后发送到前端<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">type_choices = [</div><div class="line">       (<span class="number">1</span>, <span class="string">"Python"</span>),</div><div class="line">       (<span class="number">2</span>, <span class="string">"Linux"</span>),</div><div class="line">       (<span class="number">3</span>, <span class="string">"OpenStack"</span>),</div><div class="line">       (<span class="number">4</span>, <span class="string">"GoLang"</span>),</div><div class="line">   ]</div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">type_choice_list = models.Article.type_choices  <span class="comment"># 直接从类中找的</span></div></pre></td></tr></table></figure>
<h3 id="2-下部文章用栅格分开"><a href="#2-下部文章用栅格分开" class="headerlink" title="2 下部文章用栅格分开"></a>2 下部文章用栅格分开</h3><p><a href="http://v3.bootcss.com/css/#grid" target="_blank" rel="external">http://v3.bootcss.com/css/#grid</a></p>
<p>在外侧的div设置<code>container</code> 和上面的保持一致</p>
<p>进行左右分割<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">class=&quot;col-md-8&quot;</div><div class="line">class=&quot;col-md-4&quot;</div></pre></td></tr></table></figure></p>
<h4 id="2-1-左侧内容"><a href="#2-1-左侧内容" class="headerlink" title="2.1 左侧内容"></a>2.1 左侧内容</h4><p>因为a标签占据一整行，图片的设置成浮动left，之后用clearfix清除，相当于clearboth</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"art-body clearfix"</span>&gt;</span>&#123;# clearfix 清除浮动 #&#125;</div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/static/images/1.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	近期一个项目需要用到低功耗蓝牙的开发，由于之前没有蓝牙开发的经验，发现网上关于蓝牙开发的资料不多，不是随便描述一下就是已经过时的，在此整理一篇低功耗蓝牙的入门资料，能够完成使用蓝牙的接受和发送数据。 低功耗蓝牙 (BLE，</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h5 id="从后台数据查询文章表的信息，然后传递给后台"><a href="#从后台数据查询文章表的信息，然后传递给后台" class="headerlink" title="从后台数据查询文章表的信息，然后传递给后台"></a>从后台数据查询文章表的信息，然后传递给后台</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="comment"># type_choices_list = models.Article.objects.type_choice  # 这是错误的 这是从数据库中找</span></div><div class="line">    type_choice_list = models.Article.type_choices  <span class="comment"># 直接从类中找的</span></div><div class="line">    articel_list = models.Article.objects.all()</div><div class="line">    <span class="keyword">return</span> render(</div><div class="line">        request,</div><div class="line">        <span class="string">'index.html'</span>,</div><div class="line">        &#123;</div><div class="line">            <span class="string">'type_choice_list'</span>:type_choice_list,</div><div class="line">            <span class="string">'articel_list'</span>:articel_list,</div><div class="line">        &#125;</div><div class="line">    )</div></pre></td></tr></table></figure>
<p><strong>前端:</strong></p>
<p>在前端页面用for循环进行展示页面，文章表中有的直接从文章表中查找</p>
<p><strong>头像</strong>通过blog与用户关联，BLog表与Userinfo是OneToOne关系，直接点出avatar。</p>
<p>img 的src是<code>src=&quot;&quot;</code>.关键是数据库中存储的是图片的路径，是一个字符串，<code>/static/images/1.jpg</code></p>
<p>下面是userinfo表中的avatar字段，存储的是头像的路径。<br><img src="http://images2015.cnblogs.com/blog/658994/201707/658994-20170711160152556-1014780662.jpg" alt=""></p>
<ul>
<li>发布时间设置成固定的格式<code>articel.create_time|date:&#39;Y-m-d&#39;</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">&#123;% for articel in articel_list %&#125;</div><div class="line">           <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-list"</span> <span class="attr">style</span>=<span class="string">"padding: 20px"</span>&gt;</span></div><div class="line">           &#123;# 文章的内容 标题 简介 头像 #&#125;</div><div class="line">           <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"article-item"</span>&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"art-head"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>&#123;&#123; articel.title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"art-body clearfix"</span> &gt;</span>&#123;# clearfix 清除浮动 #&#125;</div><div class="line">                   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; articel.blog.user.avatar &#125;&#125;"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                   &#123;&#123; articel.summary &#125;&#125;</div><div class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">               &#123;# 文章的作者信息 发布时间 点赞 #&#125;</div><div class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"art-foot"</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span></div><div class="line">                       <span class="tag">&lt;<span class="name">span</span>  <span class="attr">class</span>=<span class="string">"fa fa-user-circle"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                       作者:&#123;&#123; articel.blog.user.username &#125;&#125;</div><div class="line">                   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span></div><div class="line">                       <span class="tag">&lt;<span class="name">span</span>&gt;</span>发布时间:&#123;&#123; articel.create_time|date:'Y-m-d' &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span></div><div class="line">                       <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"fa fa-commenting"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>评论(&#123;&#123; articel.comment_count &#125;&#125;)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span></div><div class="line">                       <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"fa fa-thumbs-up"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>赞(&#123;&#123; articel.up_count &#125;&#125;)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span></div><div class="line">                       <span class="tag">&lt;<span class="name">span</span>  <span class="attr">class</span>=<span class="string">"fa fa-book"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>阅读(&#123;&#123; articel.read_count &#125;&#125;)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">               <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">           <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">       &#123;% endfor %&#125;</div></pre></td></tr></table></figure>
<h5 id="对文章内容进行筛选"><a href="#对文章内容进行筛选" class="headerlink" title="对文章内容进行筛选"></a>对文章内容进行筛选</h5><p>文章内容的筛选是通过跳转不同的URL进行的，有一个all，<strong>all和主页兼容</strong>。其他的是Python、Linux、go..</p>
<p><strong>1 ULR设置</strong></p>
<p>下面的情况是访问all/1的时候和index的是一样的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</div><div class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</div><div class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views</div><div class="line"></div><div class="line">urlpatterns = [</div><div class="line">    url(<span class="string">r'^admin/'</span>, admin.site.urls),</div><div class="line">    url(<span class="string">r'^all/(\d+)'</span>, views.index),  <span class="comment"># 这里修改成带参数的</span></div><div class="line">    url(<span class="string">r'^index/'</span>, views.index),</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>后台要兼容两种情况，使用<em>args，*</em>kwargs进行接收<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request,*args,**kwargs)</span>:</span></div></pre></td></tr></table></figure></p>
<p><strong>2 URL进一步修改</strong></p>
<p>使用<code>?P&lt;type_id&gt;</code>是传具体的值到后台，后台用**kwargs进行接收</p>
<p>**kwargs不一定有，访问index的时候为空，访问all/1的时候获取的是type_id的值，通过type_id的值可以对文章类型进行过滤。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">urlpatterns = [</div><div class="line">    url(<span class="string">r'^admin/'</span>, admin.site.urls),</div><div class="line">    url(<span class="string">r'^all/(?P&lt;type_id&gt;\d+)'</span>, views.index), <span class="comment"># 按关键字传值</span></div><div class="line">    url(<span class="string">r'^'</span>, views.index),  <span class="comment"># 默认直接访问主站</span></div><div class="line">]</div></pre></td></tr></table></figure>
<p><strong>3 对文章进行筛选</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request,*args,**kwargs)</span>:</span></div><div class="line">    <span class="comment"># type_choices_list = models.Article.objects.type_choice  # 这是错误的 这是从数据库中找</span></div><div class="line">    type_choice_list = models.Article.type_choices  <span class="comment"># 直接从类中找的</span></div><div class="line">    type_id = int(kwargs.get(<span class="string">'type_id'</span>)) <span class="keyword">if</span> kwargs.get(<span class="string">'type_id'</span>) <span class="keyword">else</span> <span class="keyword">None</span>  <span class="comment"># 如果kwargs中获取到文类型id 则转换成int,否则返回None</span></div><div class="line">    <span class="keyword">if</span> type_id:</div><div class="line">        articel_list = models.Article.objects.filter(article_type_id=type_id)  <span class="comment"># 如果是all/1的情况 显示过滤的文章类型</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        articel_list = models.Article.objects.all()  <span class="comment"># 访问主页的情况，查询所有的数据</span></div><div class="line">    <span class="keyword">return</span> render(</div><div class="line">        request,</div><div class="line">        <span class="string">'index.html'</span>,</div><div class="line">        &#123;</div><div class="line">            <span class="string">'type_choice_list'</span>:type_choice_list,</div><div class="line">            <span class="string">'articel_list'</span>:articel_list,</div><div class="line">        &#125;</div><div class="line">    )</div></pre></td></tr></table></figure>
<p><strong>4修改切换的URL</strong></p>
<p>全部的时候用<code>/</code>代表主页，用all/ 拼接路径，拼成all/1,all/2</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">          &#123;% for item in type_choice_list %&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/all/&#123;&#123; item.0 &#125;&#125;/"</span>&gt;</span>&#123;&#123; item.1 &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">          &#123;% endfor %&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>5 切换的时候激活</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></div><div class="line">         &#123;% if type_id %&#125;</div><div class="line">             <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">         &#123;% else %&#125;</div><div class="line">             <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">         &#123;% endif %&#125;</div><div class="line">         &#123;% for item in type_choice_list %&#125;</div><div class="line">             &#123;% if item.0 == type_id %&#125;</div><div class="line">                 <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/all/&#123;&#123; item.0 &#125;&#125;/"</span>&gt;</span>&#123;&#123; item.1 &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">             &#123;% else %&#125;</div><div class="line">               <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/all/&#123;&#123; item.0 &#125;&#125;/"</span>&gt;</span>&#123;&#123; item.1 &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">              &#123;% endif %&#125;</div><div class="line">         &#123;% endfor %&#125;</div></pre></td></tr></table></figure>
<h4 id="2-2-右侧内容"><a href="#2-2-右侧内容" class="headerlink" title="2.2 右侧内容"></a>2.2 右侧内容</h4><p>在右侧添加面板</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-4"</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span> 最新<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>1111<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>1111<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>1111<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>1111<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span> 最热<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>1111<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>1111<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>1111<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>1111<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="登录界面"><a href="#登录界面" class="headerlink" title="登录界面"></a>登录界面</h3><p>注意设置URL的时候，login放在index的前面，index放在最后。路由是从上往下找。<br>设置name属性</p>
<h4 id="验证功能"><a href="#验证功能" class="headerlink" title="验证功能"></a>验证功能</h4><p>验证码的宽度调节<code>class=&quot;col-sm-5&quot;</code>，左右设置成5</p>
<p><strong>1 通过URL获取获取图片</strong></p>
<p>img的src属性设置成一个路径，如果设置成一个静态路径，Django内部自动把图片显示。<br>下面是通过函数的形式，返回值是图片</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-5"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">"width: 120px;height: 30px;"</span> <span class="attr">src</span>=<span class="string">"/check_code/"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>对应URL：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url(<span class="string">r'^check_code/'</span>, views.check_code),</div></pre></td></tr></table></figure></p>
<p>读取文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_code</span><span class="params">(request)</span>:</span></div><div class="line">    f = open(<span class="string">'static/images/1.jpg'</span>, <span class="string">'rb'</span>)  <span class="comment"># 使用rb模式读取</span></div><div class="line">    data = f.read()</div><div class="line">    f.close()</div><div class="line">    <span class="keyword">return</span> HttpResponse(data)  <span class="comment"># 返回后能直接解析</span></div></pre></td></tr></table></figure>
<p><strong>2 使用pillow自己创建文件</strong></p>
<ul>
<li>创建一个文件句柄，用于保存图片文件</li>
<li>创建一个图片对象</li>
<li>都是字节的形式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line">f = open(<span class="string">'code.png'</span>, <span class="string">'wb'</span>)  <span class="comment"># 创建一个文件句柄，用于保存图片文件</span></div><div class="line">img = Image.new(mode=<span class="string">'RGB'</span>, size=(<span class="number">120</span>, <span class="number">30</span>), color=(<span class="number">123</span>, <span class="number">255</span>, <span class="number">255</span>))  <span class="comment"># 创建一个图片对象</span></div><div class="line">img.save(f, <span class="string">'png'</span>)  <span class="comment"># 第一个是文件句柄 第二个是format</span></div><div class="line">f.close()</div><div class="line">f = open(<span class="string">'code.png'</span>, <span class="string">'rb'</span>)  <span class="comment"># 使用rb模式读取</span></div><div class="line">data = f.read()</div><div class="line">f.close()</div><div class="line"><span class="keyword">return</span> HttpResponse(data)</div></pre></td></tr></table></figure>
<p><strong>3 从内存中读取 BytesIO模块</strong></p>
<p>上面的方式是：<code>创建图片-&gt;内存-&gt;硬盘-&gt;内存</code>，最好的方式是直接从内存中获取。</p>
<p>Python的BytesIO模块在内存中开辟一块空间</p>
<ul>
<li>创建BytesIO对象</li>
<li>在内存中保存的格式</li>
<li>从内存中获取数据getvalue</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line">   <span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</div><div class="line">   f = BytesIO()</div><div class="line">   img = Image.new(mode=<span class="string">'RGB'</span>, size=(<span class="number">120</span>, <span class="number">30</span>), color=(<span class="number">123</span>, <span class="number">255</span>, <span class="number">255</span>))  <span class="comment"># 创建一个图片对象</span></div><div class="line">   img.save(f,<span class="string">'png'</span>)</div><div class="line">   data = f.getvalue()  <span class="comment"># 从内存中获取数据</span></div><div class="line"></div><div class="line">   <span class="keyword">return</span> HttpResponse(data)</div></pre></td></tr></table></figure>
<p><strong>4 创建白板 画笔对象</strong></p>
<h5 id="画点"><a href="#画点" class="headerlink" title="画点"></a>画点</h5><ul>
<li>ImageDraw</li>
<li>ImageDraw.Draw(img,’RGB’)</li>
<li>draw.point([10,10],fill=’red’)  # 坐标 颜色</li>
<li>draw.point([30,10],fill=(255,255,255)) # 颜色的两种表示形式</li>
<li>随机颜色 random</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image,ImageDraw</div><div class="line">   <span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</div><div class="line">   f = BytesIO()</div><div class="line">   img = Image.new(mode=<span class="string">'RGB'</span>, size=(<span class="number">120</span>, <span class="number">30</span>), color=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))  <span class="comment"># 创建一个图片对象</span></div><div class="line">   draw = ImageDraw.Draw(img,<span class="string">'RGB'</span>)</div><div class="line">   draw.point([<span class="number">10</span>,<span class="number">10</span>],fill=<span class="string">'red'</span>)</div><div class="line">   draw.point([<span class="number">20</span>,<span class="number">10</span>],fill=<span class="string">'red'</span>)</div><div class="line">   draw.point([<span class="number">30</span>,<span class="number">10</span>],fill=(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</div><div class="line">   img.save(f,<span class="string">'png'</span>)</div><div class="line">   data = f.getvalue()  <span class="comment"># 从内存中获取数据</span></div><div class="line"></div><div class="line">   <span class="keyword">return</span> HttpResponse(data)</div></pre></td></tr></table></figure>
<h5 id="画线"><a href="#画线" class="headerlink" title="画线"></a>画线</h5><ul>
<li>起始位置的坐标</li>
<li>两种颜色</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">draw.line((<span class="number">15</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">50</span>), fill=<span class="string">'red'</span>)</div><div class="line">   draw.line((<span class="number">45</span>, <span class="number">20</span>, <span class="number">100</span>, <span class="number">100</span>), fill=(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>))</div></pre></td></tr></table></figure>
<h5 id="画圆"><a href="#画圆" class="headerlink" title="画圆"></a>画圆</h5><ul>
<li>找到两点，长方形中画圆的大小</li>
<li>角度0,90/0，180</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">draw.arc((<span class="number">0</span>,<span class="number">0</span>,<span class="number">30</span>,<span class="number">30</span>),<span class="number">0</span>,<span class="number">360</span>,fill=<span class="string">"red"</span>)</div></pre></td></tr></table></figure>
<h5 id="写文字及字体"><a href="#写文字及字体" class="headerlink" title="写文字及字体"></a>写文字及字体</h5><ul>
<li>坐标</li>
<li>文字</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">draw.text([<span class="number">0</span>, <span class="number">0</span>], <span class="string">'python'</span>, <span class="string">"red"</span>)</div></pre></td></tr></table></figure>
<p>引入字体对象 import ImageFont</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">font = ImageFont.truetype(<span class="string">"kumo.ttf"</span>, <span class="number">28</span>)  <span class="comment"># 字体及字体大小</span></div><div class="line">draw.text([<span class="number">0</span>, <span class="number">0</span>], <span class="string">'python'</span>, <span class="string">"red"</span>,font=font)</div></pre></td></tr></table></figure>
<p><strong> 5 绘制随机字符 随机颜色</strong></p>
<ul>
<li>[i*24, 0] 总长是120 5个字符</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random</div><div class="line"></div><div class="line">  <span class="comment"># char_list = []</span></div><div class="line">  <span class="comment"># for i in range(5):</span></div><div class="line">  <span class="comment">#     char = chr(random.randint(65,90))</span></div><div class="line">  <span class="comment">#     char_list.append(char)</span></div><div class="line">  <span class="comment">#     ''.join(char_list)</span></div><div class="line"></div><div class="line">  <span class="comment"># v =''.join([chr(random.randint(65,90)) for i in range(5)])</span></div><div class="line">  char_list = []</div><div class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</div><div class="line">      char = chr(random.randint(<span class="number">65</span>,<span class="number">90</span>))</div><div class="line">      char_list.append(char)</div><div class="line">      font = ImageFont.truetype(<span class="string">"kumo.ttf"</span>, <span class="number">28</span>)  <span class="comment"># 字体及字体大小</span></div><div class="line">      draw.text([i*<span class="number">24</span>, <span class="number">0</span>], char,(random.randint(<span class="number">0</span>,<span class="number">255</span>) ,random.randint(<span class="number">0</span>,<span class="number">255</span>) ,random.randint(<span class="number">0</span>,<span class="number">255</span>)),font=font)</div><div class="line"></div><div class="line">  img.save(f,<span class="string">'png'</span>)</div><div class="line">  data = f.getvalue()  <span class="comment"># 从内存中获取数据</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> HttpResponse(data)</div></pre></td></tr></table></figure>
<p><strong>6 通过session保存</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">char_list = []</div><div class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</div><div class="line">       char = chr(random.randint(<span class="number">65</span>,<span class="number">90</span>))</div><div class="line">       char_list.append(char)</div><div class="line">       font = ImageFont.truetype(<span class="string">"kumo.ttf"</span>, <span class="number">28</span>)  <span class="comment"># 字体及字体大小</span></div><div class="line">       draw.text([i*<span class="number">24</span>, <span class="number">0</span>], char,(random.randint(<span class="number">0</span>,<span class="number">255</span>) ,random.randint(<span class="number">0</span>,<span class="number">255</span>) ,random.randint(<span class="number">0</span>,<span class="number">255</span>)),font=font)</div><div class="line"></div><div class="line">   img.save(f,<span class="string">'png'</span>)</div><div class="line">   data = f.getvalue()  <span class="comment"># 从内存中获取数据</span></div><div class="line">   code  = <span class="string">''</span>.join(char_list)</div><div class="line">   request.session[<span class="string">'code'</span>] = code</div><div class="line"></div><div class="line">   <span class="keyword">return</span> HttpResponse(data)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></div><div class="line">   <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">       <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>)</div><div class="line">   <span class="keyword">else</span>:</div><div class="line">       input_code = request.POST.get(<span class="string">'code'</span>)</div><div class="line">       session_code = request.session.get(<span class="string">'code'</span>)</div><div class="line">       <span class="keyword">if</span> input_code.upper() == session_code.upper(): <span class="comment"># 忽略大小写</span></div><div class="line">           <span class="keyword">pass</span></div><div class="line">       <span class="keyword">else</span>:</div><div class="line">           <span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p><strong>7 把验证码制作成一个模块</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</div><div class="line"><span class="keyword">from</span> utils.random_check_code <span class="keyword">import</span> rd_check_code</div><div class="line">img, code =rd_check_code() <span class="comment"># 返回值是img 和code</span></div><div class="line">stream = BytesIO()</div><div class="line">img.save(stream,<span class="string">'png'</span>)</div><div class="line">request.session[<span class="string">'code'</span>] = code</div><div class="line"><span class="keyword">return</span> HttpResponse(stream.getvalue())</div></pre></td></tr></table></figure>
<h3 id="注册页面"><a href="#注册页面" class="headerlink" title="注册页面"></a>注册页面</h3><p>注册页面使用了Form组件进行验证，功能</p>
<ul>
<li>在前端生成HTML标签，保留输入的信息</li>
<li>对输入的内容进行验证</li>
</ul>
<h4 id="Form组件"><a href="#Form组件" class="headerlink" title="Form组件"></a>Form组件</h4><p>把输入Form的类专门写到了app01的forms.py中。</p>
<ul>
<li>在form中验证验证码，需要request.session，但是form中没有</li>
<li>用super重写类的<strong>init</strong>()方法，把request作为参数传入RegisterForm类中，</li>
<li>在clean_字段()函数中，通过验证后，返回值是那个字段或者是<br>return input_code  # 验证通过把自身返回 return self.cleaned_data[‘code’]</li>
<li>在clean()中对总体的进行验证，通过验证的返回值是<strong>None</strong>或者是<strong>return self.cleaned_data</strong></li>
</ul>
<p>下面是源码中的实现：</p>
<p>查看add_eror:<code>forms.py-&gt;add_error-&gt;NON_FIELD_ERRORS</code>,跳转到exceptions.py中<code>NON_FIELD_ERRORS = &#39;__all__&#39;</code>,最终错误信息会保存在<strong>all</strong>中</p>
<p>通过验证后，返回None或者self.cleaned_data</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_clean_form</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        cleaned_data = self.clean()</div><div class="line">    <span class="keyword">except</span> ValidationError <span class="keyword">as</span> e:</div><div class="line">        self.add_error(<span class="keyword">None</span>, e)  <span class="comment"># 没有通过验证把错误信息放到None中，实际是在__all__中</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">if</span> cleaned_data <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">            self.cleaned_data = cleaned_data</div></pre></td></tr></table></figure>
<ul>
<li>clean的没有通过验证后抛出的错误是</li>
<li>下面在在验证两次密码的时候，通过验证的返回值可以是None，因为不用获取通过验证的信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> Form</div><div class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> fields</div><div class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> widgets</div><div class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</div><div class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterForm</span><span class="params">(Form)</span>:</span></div><div class="line">    username = fields.CharField(</div><div class="line">        widget=widgets.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control'</span>, <span class="string">'placeholder'</span>: <span class="string">"用户名"</span>&#125;)</div><div class="line">    )</div><div class="line">    password = fields.CharField(</div><div class="line">        widget=widgets.PasswordInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control'</span>, <span class="string">'placeholder'</span>: <span class="string">"密码"</span>&#125;)</div><div class="line">    )</div><div class="line">    password2 = fields.CharField(</div><div class="line">        widget=widgets.PasswordInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control'</span>, <span class="string">'placeholder'</span>: <span class="string">"确认密码"</span>&#125;)</div><div class="line">    )</div><div class="line">    avatar = fields.FileField(</div><div class="line">        widget=widgets.FileInput(</div><div class="line">            attrs=&#123;<span class="string">'id'</span>: <span class="string">'imgSelect'</span>, <span class="string">'class'</span>: <span class="string">'f1'</span>&#125;</div><div class="line">        )</div><div class="line">    )</div><div class="line">    code = fields.CharField(</div><div class="line">        widget=widgets.TextInput(</div><div class="line">            attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control'</span>, <span class="string">'placeholder'</span>: <span class="string">"验证码"</span>&#125;</div><div class="line">        )</div><div class="line">    )</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, request, *args, **kwargs)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        在form中验证验证码，需要request.session，但是form中没有，</div><div class="line">        用super重写类的__init__()方法，把request作为参数传入RegisterForm类中，</div><div class="line">        :param request:</div><div class="line">        :param args:</div><div class="line">        :param kwargs:</div><div class="line">        """</div><div class="line">        super(RegisterForm, self).__init__(*args, **kwargs)</div><div class="line">        self.request = request</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_code</span><span class="params">(self)</span>:</span></div><div class="line">        input_code = self.cleaned_data[<span class="string">'code'</span>]  <span class="comment"># 从验证的code中获取输入的验证码</span></div><div class="line">        session_code = self.request.session.get(<span class="string">'code'</span>)  <span class="comment"># 从session中获取验证码</span></div><div class="line">        <span class="keyword">if</span> input_code.upper() == session_code.upper():</div><div class="line">            <span class="keyword">return</span> input_code  <span class="comment"># 验证通过把自身返回 return self.cleaned_data['code']</span></div><div class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">"验证码错误"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        总体验证</div><div class="line">        下面对两次密码进行验证</div><div class="line">        :return:</div><div class="line">        """</div><div class="line">        pwd1 = self.cleaned_data.get(<span class="string">'password'</span>)</div><div class="line">        pwd2 = self.cleaned_data.get(<span class="string">'password2'</span>)</div><div class="line">        <span class="keyword">if</span> pwd1 == pwd2:</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># 或者是return self.cleaned_data  因为不用获取通过验证后的密码信息</span></div><div class="line">        self.add_error(<span class="string">"password2"</span>,ValidationError(<span class="string">"两次密码不一致"</span>))  <span class="comment"># 指定在password2字段中的抛出错误</span></div><div class="line">        <span class="comment"># 第一个参数是None的时候，错误信息会加入__all__中</span></div></pre></td></tr></table></figure>
<ul>
<li>和后台用obj.errors[‘<strong>all</strong>‘]和obj.errors[NON_FIELD_ERRORS]都能打印错误</li>
<li>但是前端要用obj.non_field_errors  <strong>没有errors，小写的non_field_errors</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    用户注册</div><div class="line">    :param request:</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        obj = RegisterForm(request)  <span class="comment"># 自己重写了类的__init__()方法 向类中传入参数request</span></div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'register.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div><div class="line"></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        obj = RegisterForm(request,request.POST,request.FILES) <span class="comment"># 也要添加参数request</span></div><div class="line">        print(<span class="string">'......'</span>)</div><div class="line">        <span class="keyword">if</span> obj.is_valid():</div><div class="line">            <span class="keyword">pass</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            print(obj.errors[<span class="string">'__all__'</span>])  <span class="comment"># 没有通过验证打印错误&lt;ul class="errorlist nonfield"&gt;&lt;li&gt;两次密码不一致&lt;/li&gt;&lt;/ul&gt;</span></div><div class="line">            print(obj.errors[NON_FIELD_ERRORS])  <span class="comment"># 打印错误&lt;ul class="errorlist nonfield"&gt;&lt;li&gt;两次密码不一致&lt;/li&gt;&lt;/ul&gt;</span></div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'register.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div></pre></td></tr></table></figure>
<p><strong>指定固定字段的错误</strong></p>
<p>把None替换成password2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    总体验证</div><div class="line">    下面对两次密码进行验证</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    pwd1 = self.cleaned_data.get(<span class="string">'password'</span>)</div><div class="line">    pwd2 = self.cleaned_data.get(<span class="string">'password2'</span>)</div><div class="line">    <span class="keyword">if</span> pwd1 == pwd2:</div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># 或者是return self.cleaned_data</span></div><div class="line">    self.add_error(<span class="string">"password2"</span>, ValidationError(<span class="string">"两次密码不一致"</span>)) <span class="comment"># 指定在password2字段中的抛出错误</span></div></pre></td></tr></table></figure>
<p><strong>前端有两种形式</strong><br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;&#123; obj.code &#125;&#125; &#123;&#123; obj.non_field_errors &#125;&#125;</div><div class="line">或者</div><div class="line">&#123;&#123; obj.code &#125;&#125; &#123;&#123; obj.errors.code.0 &#125;&#125;</div></pre></td></tr></table></figure></p>
<p>obj.errors是下面的字典数据<br>“””<br>{<br>    <strong>all</strong>: [错误1，错误2]<br>    user: [错误1，错误2]<br>    password: [错误1，错误2]<br>}<br>“””</p>
<h4 id="验证码验证-并点击刷新验证码"><a href="#验证码验证-并点击刷新验证码" class="headerlink" title="验证码验证 并点击刷新验证码"></a>验证码验证 并点击刷新验证码</h4><p>刷新验证码的原理，在URL后面添加？会重新提交请求</p>
<p>给验证码图片绑定onclick事件，传入了this参数</p>
<p>function中的参数不能用this，所以用了ths,ths就代表了当前点击的对象<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-5"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">onclick</span>=<span class="string">"changeCode(this);"</span> <span class="attr">title</span>=<span class="string">"点击更新图片"</span> <span class="attr">style</span>=<span class="string">"width: 120px;height: 30px;"</span> <span class="attr">src</span>=<span class="string">"/check_code/"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeCode</span>(<span class="params">ths</span>) </span>&#123;</div><div class="line">        ths.src = ths.src + <span class="string">"?"</span>;<span class="comment">// 在URL后面添加？会重新提交请求，实现刷新图片</span></div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="头像预览"><a href="#头像预览" class="headerlink" title="头像预览"></a>头像预览</h4><p>头像上传的情况，用户上传了但是没有注册</p>
<p>设置默认头像，路径固定，更新头像的时候替换图片</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"upload_img"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"previewImg"</span> <span class="attr">src</span>=<span class="string">"/static/images/default.jpg"</span> <span class="attr">title</span>=<span class="string">"点击上传头像"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#imgSelect</span>&#123;</div><div class="line">    <span class="comment">/*</span></div><div class="line">    设置上传标签的大小和位置</div><div class="line">    关键是在在上面zindex</div><div class="line">    透明度设置成0</div><div class="line">    */</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">height</span>: <span class="number">70px</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">80px</span>;</div><div class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">z-index</span>:<span class="number">100</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="上传头像的默认地址设置"><a href="#上传头像的默认地址设置" class="headerlink" title="上传头像的默认地址设置"></a>上传头像的默认地址设置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">avatar = models.ImageField(verbose_name=<span class="string">'头像'</span>, upload_to=<span class="string">'static/images/temp'</span>)  <span class="comment"># 设置图片的上传路径，直接存数据库是路径</span></div></pre></td></tr></table></figure>
<p><strong>1 图片上传到浏览器</strong></p>
<p>需要浏览器的兼容性</p>
<h5 id="window-URL-createObjectURL"><a href="#window-URL-createObjectURL" class="headerlink" title="window.URL.createObjectURL"></a>window.URL.createObjectURL</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindAvatar2</span>(<span class="params"></span>) </span>&#123;</div><div class="line">$(<span class="string">'#imgSelect'</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> obj = $(<span class="keyword">this</span>)[<span class="number">0</span>].files[<span class="number">0</span>];<span class="comment">//js对象转换成DOM对象 这是文件对象</span></div><div class="line">    <span class="keyword">var</span> v = <span class="built_in">window</span>.URL.createObjectURL(obj); <span class="comment">// 把文件对象传入，文件会缓存在浏览器中，同时生成一个浏览器URL</span></div><div class="line">    $(<span class="string">'#previewImg'</span>).attr(<span class="string">'src'</span>,v);<span class="comment">// 用浏览器内部的URL替换原来的默认图片路径</span></div><div class="line">    $(<span class="string">'#previewImg'</span>).load(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">window</span>.URL.revokeObjectURL(v); <span class="comment">// 上传的图片路径不会清空，这里手动清空</span></div><div class="line">    &#125;)</div><div class="line">&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="readAsDataURL"><a href="#readAsDataURL" class="headerlink" title="readAsDataURL"></a>readAsDataURL</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindAvatar3</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    $(<span class="string">'#imgSelect'</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> obj =$(<span class="keyword">this</span>)[<span class="number">0</span>].files[<span class="number">0</span>];</div><div class="line">        <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</div><div class="line">        reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">            $(<span class="string">'#previewImg'</span>).attr(<span class="string">'src'</span>,<span class="keyword">this</span>.result);</div><div class="line">        &#125;;</div><div class="line">        reader.readAsDataURL(obj);</div><div class="line">    &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>2 图片上传到服务器的临时路径，之后保存到固定路径</strong></p>
<p>使用ajax上传<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line">ajax上传:</div><div class="line">使用change，当图片改变的时候触发函数</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindAvata1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   $(<span class="string">'#imgSelect'</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">       <span class="keyword">var</span> obj = $(<span class="keyword">this</span>)[<span class="number">0</span>].files[<span class="number">0</span>];<span class="comment">//js对象转换成DOM对象</span></div><div class="line">       <span class="comment">// Ajax发送后台，并获取路径</span></div><div class="line">       <span class="comment">// img.src = 获取路径</span></div><div class="line">   &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>3 浏览器的兼容代码</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">changeCode</span>(<span class="params">ths</span>) </span>&#123;</div><div class="line">            ths.src = ths.src + <span class="string">"?"</span>;<span class="comment">// 在URL后面添加？会重新提交请求，实现刷新图片</span></div><div class="line">        &#125;</div><div class="line">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            bindAvatar();  <span class="comment">//入口函数</span></div><div class="line">        &#125;);</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">bindAvatar</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="comment">/*</span></div><div class="line">            浏览器兼容性</div><div class="line">            如果浏览器有window.URL.createObjectURL这个对象,执行bindAvatar2</div><div class="line">            如果浏览器有window.FileReader对象，执行 bindAvatar3();</div><div class="line">            最后其他的浏览器执行ajax的上传</div><div class="line">             */</div><div class="line">            <span class="keyword">if</span>(<span class="built_in">window</span>.URL.createObjectURL)&#123;</div><div class="line">                bindAvatar2();</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">window</span>.FileReader)&#123;</div><div class="line">                 bindAvatar3();</div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                bindAvatar1();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/*</span></div><div class="line">         ajax上传:</div><div class="line">         使用change，当图片改变的时候触发函数</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">bindAvatar1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            $(<span class="string">'#imgSelect'</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> obj = $(<span class="keyword">this</span>)[<span class="number">0</span>].files[<span class="number">0</span>];<span class="comment">//js对象转换成DOM对象</span></div><div class="line">                <span class="comment">// Ajax发送后台，并获取路径</span></div><div class="line">                <span class="comment">// img.src = 获取路径</span></div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*</span></div><div class="line">         本地上传预览</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">bindAvatar2</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            $(<span class="string">'#imgSelect'</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> obj = $(<span class="keyword">this</span>)[<span class="number">0</span>].files[<span class="number">0</span>];<span class="comment">//js对象转换成DOM对象 这是文件对象</span></div><div class="line">                <span class="keyword">var</span> v = <span class="built_in">window</span>.URL.createObjectURL(obj); <span class="comment">// 把文件对象传入，文件会缓存在浏览器中，同时生成一个浏览器URL</span></div><div class="line">                $(<span class="string">'#previewImg'</span>).attr(<span class="string">'src'</span>,v);<span class="comment">// 用浏览器内部的URL替换原来的默认图片路径</span></div><div class="line">                $(<span class="string">'#previewImg'</span>).load(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="built_in">window</span>.URL.revokeObjectURL(v); <span class="comment">// 上传的图片路径不会清空，这里手动清空</span></div><div class="line">                &#125;)</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">bindAvatar3</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            $(<span class="string">'#imgSelect'</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> obj =$(<span class="keyword">this</span>)[<span class="number">0</span>].files[<span class="number">0</span>];</div><div class="line">                <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</div><div class="line">                reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">                    $(<span class="string">'#previewImg'</span>).attr(<span class="string">'src'</span>,<span class="keyword">this</span>.result);</div><div class="line">                &#125;;</div><div class="line">                reader.readAsDataURL(obj);</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>5 ajax上传的时候设置csrf</strong></p>
<p>ajax上传的时候需要把随机字符串发送给后台，隐藏在页面中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;input type=&apos;hidden&apos; name=&apos;csrfmiddlewaretoken&apos; value=&apos;u5j5YY4Z6h4QbvdfHypqyVekCjcPNpdyqEyUDZdW6UM4aK0DEu6PuhGMiOm2AMPQ&apos; /&gt;</div></pre></td></tr></table></figure>
<p>有两种方式进行发送：</p>
<h4 id="1-通过从页面获取csrfmiddlewaretoken-在数据中发送"><a href="#1-通过从页面获取csrfmiddlewaretoken-在数据中发送" class="headerlink" title="1 通过从页面获取csrfmiddlewaretoken,在数据中发送"></a>1 通过从页面获取csrfmiddlewaretoken,在数据中发送</h4><p>但是这里是通过formdata对象发送的，把csrf_token添加到data中挺复杂，不推荐使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$.ajax(&#123;</div><div class="line">    var csrf_token = $('input[name="csrfmiddlewaretoken"]').val();</div><div class="line">    url:'/.../',</div><div class="line">    type:'POST',</div><div class="line">    data:&#123;'csrfmiddlewaretoken':csrf_token&#125;, // 这里的key是csrfmiddlewaretoken</div><div class="line">    success:function(arg)&#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h4 id="2-使用jquery-cookie-js-把-X-CSRFToken写请求头进行发送"><a href="#2-使用jquery-cookie-js-把-X-CSRFToken写请求头进行发送" class="headerlink" title="2 使用jquery.cookie.js 把 X-CSRFToken写请求头进行发送"></a>2 使用jquery.cookie.js 把 X-CSRFToken写请求头进行发送</h4><p><img src="http://images2015.cnblogs.com/blog/658994/201707/658994-20170714195708868-1114842692.jpg" alt=""></p>
<p>Django接收后会进行处理，这里的与页面的是不一致的，Django在后台应该是转换，判断是否和发送到前端的是否一致。</p>
<ul>
<li>使用jquery.cookie.js获取浏览器的cookie，引入jquery.cookie.js文件</li>
<li><code>headers:{&#39;X-CSRFToken&#39;: token},</code> // 在请求头中发送X-CSRFToken，Django自动接收</li>
<li>var token = $.cookie(‘csrftoken’); // 通过cookie获取csrftoken</li>
<li>csrftoken是保存在cookie中的名字</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery.cookie.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">        /*</div><div class="line">         ajax上传:</div><div class="line">         使用change，当图片改变的时候触发函数</div><div class="line">         */</div><div class="line">        function bindAvatar1() &#123;</div><div class="line">            $('#imgSelect').change(function () &#123;</div><div class="line">                var formData = new FormData(); //用一个FormData对象发送</div><div class="line">&#123;#                var obj = $(this)[0].files[0];//js对象转换成DOM对象#&#125;</div><div class="line">                formData.append('upload_file',$('#imgSelect')[0].files[0]); // 使用jQuery获取文件对象</div><div class="line">                // Ajax发送后台，并获取路径</div><div class="line">                // img.src = 获取路径</div><div class="line">&#123;#                var csrf_val = $('input[name="csrfmiddlewaretoken"]').val();#&#125;</div><div class="line">                var token = $.cookie('csrftoken'); // 通过cookie获取csrftoken</div><div class="line">                $.ajax(&#123;</div><div class="line">                    url:'/register/',</div><div class="line">                    type:'POST',</div><div class="line">                    headers:&#123;'X-CSRFToken': token&#125;, // 在请求头中发送X-CSRFToken，Django自动接收</div><div class="line">                    data:formData,</div><div class="line">                    contentType:false,</div><div class="line">                    processData:false,</div><div class="line">                    success:function (arg) &#123;</div><div class="line">                        var new_img_url = $('#previewImg').src ='/'+ arg; // 返回值args就是文件路径  静态文件路径的开头有 斜杠</div><div class="line">                        $('#previewImg').attr('src',new_img_url);</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">            &#125;)</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<h3 id="个人页面"><a href="#个人页面" class="headerlink" title="个人页面"></a>个人页面</h3><p><strong>个人页面的设计思路：</strong></p>
<p>用户发过来请求，带着博客后缀，就知道了是哪个博客，通过Blog表获得blog对象，通过博客对象可以获取用户的博客信息，用户信息，文章</p>
<p>Blog对象理解：</p>
<p><code>用户</code>-&gt;<code>博客</code>-&gt;<code>博客下的所有文章</code></p>
<p>通过site确定用户，并过滤出用户的博客对象，博客对象中含有用户博客的信息，如图1中的内容。</p>
<p>想要对文章进行筛选，就是通过博客对象获取所有的文章，有两种方式：</p>
<p>1、 Article表中的字段blog是外键，实际上<strong>外键就是代表了Blog表中的一行对象</strong>，所以blog字段=blog对象</p>
<p>2、外键在表中会自动添加_id，代表的是详细的值，(确切的说是id,对应的就是Blog表中的nid,看图2)blog.nid是blog对象中实际的值，这里相当于是赋值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">(request, site)</span>:</span></div><div class="line">    blog = models.Blog.objects.filter(site=site).first()  <span class="comment"># 实际就是获取的博客表中某一用户一行对象</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    下面是测试代码，all1 和all2都是获取的所有文章</div><div class="line">    """</div><div class="line">    all1 = models.Article.objects.filter(blog=blog)  <span class="comment"># 获取当前博客的所有文章  外键代表的就是另一张表中的一行对象</span></div><div class="line">    all2 = models.Article.objects.filter(blog_id=blog.nid)  <span class="comment"># blog_id是外键的名字，自动加上的_id</span></div><div class="line">    print(<span class="string">"test....................."</span>)</div><div class="line">    print(all1)</div><div class="line">    print(all2)</div></pre></td></tr></table></figure>
<p>图1：<br><img src="http://images2015.cnblogs.com/blog/658994/201707/658994-20170718155631208-2117733180.jpg" alt=""></p>
<p>图2：<br><img src="http://images2015.cnblogs.com/blog/658994/201707/658994-20170718155031521-882545890.jpg" alt=""></p>
<h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>文章分类表分析：</p>
<p>1 先筛选文章表中某一用户的所有文章，在SQL中是where条件，在model中是通过blog对象</p>
<p>2 分组group by,对category_id进行分组，在models中是用values和annotate共同组成分组条件</p>
<p>3 values(‘category_id’, ‘category<strong>title’)中category_id是where条件，category</strong>title是通过反向跨表获取的分类标题，就是下图中的cname–MVC</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">category_list = models.Article.objects.filter(blog=blog).values(<span class="string">'category_id'</span>, <span class="string">'category__title'</span>).annotate(</div><div class="line">        c=Count(<span class="string">'nid'</span>))  <span class="comment"># 获得文章分类</span></div></pre></td></tr></table></figure>
<p><img src="http://images2015.cnblogs.com/blog/658994/201707/658994-20170718165552365-358696163.jpg" alt=""></p>
<h4 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h4><p><strong>文章和标签表的关系是：多对多关系</strong><br>多对多是一张表中的一行数据可以对应另一张表中的多行数据，反之亦然。因此需要第三张表作为关系表。</p>
<p>这里使用了ManyToMany，同时也指定了第三张表Article2Tag和字段article，tag<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">through=<span class="string">'Article2Tag'</span>,  </div><div class="line">through_fields=(<span class="string">'article'</span>, <span class="string">'tag'</span>),</div></pre></td></tr></table></figure></p>
<p>标签分类分析：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">tag</div><div class="line"></div><div class="line">id  title  blog</div><div class="line">1   python  1</div><div class="line">2   linux   1</div><div class="line">3   Django  2 </div><div class="line"></div><div class="line">article </div><div class="line"></div><div class="line">id  title  blog (tags-ManyToMany)</div><div class="line">1    xx     1     </div><div class="line">2    dd     1   </div><div class="line">3    ee     2</div><div class="line"></div><div class="line"></div><div class="line">article2blog</div><div class="line">id article tag</div><div class="line">1  1        1</div><div class="line">2  1        2</div><div class="line">3  2        1</div><div class="line">4  3        4</div><div class="line"></div><div class="line"></div><div class="line">如tag__blog,例如blog=1的时候</div><div class="line">或者article__blog = blog</div><div class="line"></div><div class="line"></div><div class="line">article2tag------tag</div><div class="line">id article tag   tag_id  title  blog</div><div class="line">1  1        1    1       python  1    √</div><div class="line">2  1        1    1       python  1    √</div><div class="line">2  1        2    2       linux   1    √</div><div class="line">3  2        3    3       Django  2   </div><div class="line"></div><div class="line">先通过blog对象确定进行筛选，就是where条件，然后反向连表到tag,找到这篇文章的所有标签</div><div class="line"></div><div class="line">select  tag_id,title, count(id) as c from article2blog  left join tag on (article2tag.id = tag.nid) where blog_id =1  group by tag_id,title</div><div class="line"></div><div class="line">1 python 2</div><div class="line">1 lin</div></pre></td></tr></table></figure></p>
<p>实际测试：<br>下面的两种方式都是可以的，可以通过tag和article进行跨表<br>tag和article表中都有blog字段，这个是外键此时是反向跨表的操作<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">都是通过第三张表Article2Tag获得这个博客的所有标签</div><div class="line">    tags1 = models.Article2Tag.objects.filter(tag__blog=blog)</div><div class="line">    tags2 = models.Article2Tag.objects.filter(article__blog=blog)</div><div class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> tags1:</div><div class="line">        print(item.tag.title)</div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tag_list = models.Article2Tag.objects.filter(tag__blog=blog).values(<span class="string">'tag_id'</span>, <span class="string">'tag__title'</span>).annotate(c=Count(<span class="string">'id'</span>))  <span class="comment"># 这里是用的count(id) id 是article2tag中的</span></div></pre></td></tr></table></figure>
<p>用tag_list.query查看的SQL语句<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="string">`app01_article2tag`</span>.<span class="string">`tag_id`</span>, <span class="string">`app01_tag`</span>.<span class="string">`title`</span>, <span class="keyword">COUNT</span>(<span class="string">`app01_article2tag`</span>.<span class="string">`id`</span>) <span class="keyword">AS</span> <span class="string">`c`</span> <span class="keyword">FROM</span> <span class="string">`app01_article2tag`</span> <span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="string">`app01_tag`</span> <span class="keyword">ON</span> (<span class="string">`app01_article2tag`</span>.<span class="string">`tag_id`</span> = <span class="string">`app01_tag`</span>.<span class="string">`nid`</span>) <span class="keyword">WHERE</span> <span class="string">`app01_tag`</span>.<span class="string">`blog_id`</span> = <span class="number">1</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="string">`app01_article2tag`</span>.<span class="string">`tag_id`</span>, <span class="string">`app01_tag`</span>.<span class="string">`title`</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="literal">NULL</span></div></pre></td></tr></table></figure></p>
<h4 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h4><h3 id="详细页面-文章最终页"><a href="#详细页面-文章最终页" class="headerlink" title="详细页面(文章最终页)"></a>详细页面(文章最终页)</h3><h4 id="详细内容"><a href="#详细内容" class="headerlink" title="详细内容"></a>详细内容</h4><p>在页面使用safe，后台过滤script关键字</p>
<h4 id="点赞"><a href="#点赞" class="headerlink" title="点赞"></a>点赞</h4><h4 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h4><p><strong>1 评论的原理知识</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">data = [</div><div class="line">    [<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>],</div><div class="line">    [<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>]</div><div class="line">]</div><div class="line"></div><div class="line">data[<span class="number">0</span>].append(data[<span class="number">1</span>])  <span class="comment"># 这里是引用的data1的地址中的内容</span></div><div class="line">data[<span class="number">1</span>].append(<span class="number">77</span>)  <span class="comment"># data1中添加数据，data0中也会同步显示</span></div><div class="line"></div><div class="line">print(data)</div></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">     [11, 22, 33, [44, 55, 66, 77]],</div><div class="line">     [44, 55, 66, 77]</div><div class="line">]</div></pre></td></tr></table></figure></p>
<ul>
<li>在两个中都会有kk,本质也是引用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">data = [</div><div class="line">    &#123;<span class="string">'k1'</span>: <span class="string">'v1'</span>&#125;,</div><div class="line">    &#123;<span class="string">'k2'</span>: <span class="string">'v2'</span>&#125;</div><div class="line">]</div><div class="line"></div><div class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data:</div><div class="line">    item[<span class="string">'kk'</span>] = <span class="string">'vv'</span></div><div class="line"></div><div class="line">print(data)</div></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[&#123;&apos;k1&apos;: &apos;v1&apos;, &apos;kk&apos;: &apos;vv&apos;&#125;, &#123;&apos;k2&apos;: &apos;v2&apos;, &apos;kk&apos;: &apos;vv&apos;&#125;]</div></pre></td></tr></table></figure></p>
<p><strong>2 利用上述原理对数据进行处理</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">msg_list = [</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">1</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">2</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">3</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">4</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">1</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">5</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">4</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">6</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">2</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">7</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">5</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">8</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">3</span>&#125;,</div><div class="line">]</div><div class="line"></div><div class="line">[</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">1</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>, <span class="string">'child'</span>: []&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">2</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>, <span class="string">'child'</span>: []&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">3</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>, <span class="string">'child'</span>: []&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">4</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">1</span>, <span class="string">'child'</span>: []&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">5</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">4</span>, <span class="string">'child'</span>: []&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">6</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">2</span>, <span class="string">'child'</span>: []&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">7</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">5</span>, <span class="string">'child'</span>: []&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">8</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">3</span>, <span class="string">'child'</span>: []&#125;</div><div class="line">]</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">[</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">1</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>, <span class="string">'child'</span>: [&#123;<span class="string">'id'</span>: <span class="number">4</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">1</span>, <span class="string">'child'</span>: [&#123;<span class="string">'id'</span>: <span class="number">5</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">4</span>, <span class="string">'child'</span>: [&#123;<span class="string">'id'</span>: <span class="number">7</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">5</span>, <span class="string">'child'</span>: []&#125;]&#125;]&#125;]&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">2</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>, <span class="string">'child'</span>: [&#123;<span class="string">'id'</span>: <span class="number">6</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">2</span>, <span class="string">'child'</span>: []&#125;]&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">3</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>, <span class="string">'child'</span>: [&#123;<span class="string">'id'</span>: <span class="number">8</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">3</span>, <span class="string">'child'</span>: []&#125;]&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">4</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">1</span>, <span class="string">'child'</span>: []&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">5</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">4</span>, <span class="string">'child'</span>: [&#123;<span class="string">'id'</span>: <span class="number">7</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">5</span>, <span class="string">'child'</span>: []&#125;]&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">6</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">2</span>, <span class="string">'child'</span>: []&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">7</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">5</span>, <span class="string">'child'</span>: []&#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">8</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">3</span>, <span class="string">'child'</span>: []&#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<ul>
<li>因为都是引用的内存地址，所以在添加的时候，child的子子孙孙中会自动添加相应的内容</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">1</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>, <span class="string">'child'</span>: [</div><div class="line">     &#123;<span class="string">'id'</span>: <span class="number">4</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">1</span>, <span class="string">'child'</span>: [</div><div class="line">         &#123;<span class="string">'id'</span>: <span class="number">5</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">4</span>, <span class="string">'child'</span>: [</div><div class="line">             &#123;<span class="string">'id'</span>: <span class="number">7</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">5</span>, <span class="string">'child'</span>: []&#125;</div><div class="line">             ]         </div><div class="line">         &#125;]     </div><div class="line">     &#125;</div><div class="line">     ]</div><div class="line"> &#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">2</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>, <span class="string">'child'</span>: [</div><div class="line">     &#123;<span class="string">'id'</span>: <span class="number">6</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">2</span>, <span class="string">'child'</span>: []</div><div class="line">     &#125;</div><div class="line">     ]</div><div class="line"> &#125;,</div><div class="line"> &#123;<span class="string">'id'</span>: <span class="number">3</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>, <span class="string">'child'</span>: [&#123;<span class="string">'id'</span>: <span class="number">8</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">3</span>, <span class="string">'child'</span>: []&#125;]&#125;,</div></pre></td></tr></table></figure>
<p>下面的msg_list是模拟数据库取出来的数据，parent_id=None的是第一级的评论<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">msg_list = [</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">1</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">2</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">3</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">4</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">1</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">5</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">4</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">6</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">2</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">7</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">5</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">8</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">3</span>&#125;,</div><div class="line">]</div><div class="line"></div><div class="line"><span class="keyword">for</span> item <span class="keyword">in</span> msg_list:</div><div class="line">    item[<span class="string">'child'</span>] = []</div><div class="line">v = [row.setdefault(<span class="string">'child'</span>,[]) <span class="keyword">for</span> row <span class="keyword">in</span> msg_list]  <span class="comment"># 在列表生成式中使用的是setdefault方法 ，最后有返回值</span></div><div class="line"></div><div class="line">print(msg_list)</div></pre></td></tr></table></figure></p>
<p><strong>3 建立一种新的数据结构hash，快速查找</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">msg_list = [</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">1</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">2</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">3</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="keyword">None</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">4</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">1</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">5</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">4</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">6</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">2</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">7</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">5</span>&#125;,</div><div class="line">    &#123;<span class="string">'id'</span>: <span class="number">8</span>, <span class="string">'content'</span>: <span class="string">'xxx'</span>, <span class="string">'parent_id'</span>: <span class="number">3</span>&#125;,</div><div class="line">]</div><div class="line"></div><div class="line"><span class="string">"""</span></div><div class="line">建立一种Hash型的是数据结构，便于快速查找</div><div class="line">如果使用两次for循环，效率低</div><div class="line">"""</div><div class="line">msg_list_dict = &#123;&#125;</div><div class="line"><span class="keyword">for</span> item <span class="keyword">in</span> msg_list:</div><div class="line">    item[<span class="string">'child'</span>] = []</div><div class="line">    msg_list_dict[item[<span class="string">'id'</span>]]= item</div><div class="line"></div><div class="line">print(msg_list_dict)</div></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    1: &#123;&apos;id&apos;: 1, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: None, &apos;child&apos;: []&#125;,</div><div class="line">    2: &#123;&apos;id&apos;: 2, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: None, &apos;child&apos;: []&#125;,</div><div class="line">    3: &#123;&apos;id&apos;: 3, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: None, &apos;child&apos;: []&#125;,</div><div class="line">    4: &#123;&apos;id&apos;: 4, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: 1, &apos;child&apos;: []&#125;,</div><div class="line">    5: &#123;&apos;id&apos;: 5, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: 4, &apos;child&apos;: []&#125;,</div><div class="line">    6: &#123;&apos;id&apos;: 6, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: 2, &apos;child&apos;: []&#125;,</div><div class="line">    7: &#123;&apos;id&apos;: 7, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: 5, &apos;child&apos;: []&#125;,</div><div class="line">    8: &#123;&apos;id&apos;: 8, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: 3, &apos;child&apos;: []&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">实际上，索引对应的是内存地址：例如下面的情况，索引对应的是内存地址，本质就是hash算法</div><div class="line">这种字典的查找速度非常快</div><div class="line">PS：数据库有BTREE和hash,其中hash的索引快的原理也是这样的</div><div class="line">&#123;</div><div class="line">    1(456456): &#123;&apos;id&apos;: 1, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: None, &apos;child&apos;: []&#125;,</div><div class="line">    2(256556): &#123;&apos;id&apos;: 2, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: None, &apos;child&apos;: []&#125;,</div><div class="line">    3(445566): &#123;&apos;id&apos;: 3, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: None, &apos;child&apos;: []&#125;,</div><div class="line">    4(456456): &#123;&apos;id&apos;: 4, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: 1, &apos;child&apos;: []&#125;,</div><div class="line">    5(456457): &#123;&apos;id&apos;: 5, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: 4, &apos;child&apos;: []&#125;,</div><div class="line">    6(456458): &#123;&apos;id&apos;: 6, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: 2, &apos;child&apos;: []&#125;,</div><div class="line">    7(456459): &#123;&apos;id&apos;: 7, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: 5, &apos;child&apos;: []&#125;,</div><div class="line">    8(545645): &#123;&apos;id&apos;: 8, &apos;content&apos;: &apos;xxx&apos;, &apos;parent_id&apos;: 3, &apos;child&apos;: []&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Django-admin的后台管理"><a href="#Django-admin的后台管理" class="headerlink" title="Django admin的后台管理"></a>Django admin的后台管理</h3><h4 id="创建superuser用户"><a href="#创建superuser用户" class="headerlink" title="创建superuser用户"></a>创建superuser用户</h4><p><strong>1 创建superuser用户</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python3 manage.py createsuperuser</div></pre></td></tr></table></figure>
<p><strong>2 设置用户名和密码</strong></p>
<p>设置用户名为root，邮箱可以为空，密码要设置复杂密码</p>
<p><strong>3 在admin.py中注册</strong></p>
<p>需要首先导入models</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</div><div class="line"></div><div class="line">admin.site.register(models.UserInfo)</div><div class="line">admin.site.register(models.Blog)</div><div class="line">admin.site.register(models.UserFans)</div><div class="line">admin.site.register(models.Category)</div><div class="line">admin.site.register(models.ArticleDetail)</div><div class="line">admin.site.register(models.UpDown)</div><div class="line">admin.site.register(models.Comment)</div><div class="line">admin.site.register(models.Tag)</div><div class="line">admin.site.register(models.Article)</div><div class="line">admin.site.register(models.Article2Tag)</div></pre></td></tr></table></figure>
<p><strong>4 在类中使用<strong>str</strong>方法</strong></p>
<p>Django admin后台默认显示的是object，使用<strong>str</strong>方法显示相应的内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="keyword">return</span> self.username</div></pre></td></tr></table></figure>
<h2 id="后台管理"><a href="#后台管理" class="headerlink" title="后台管理"></a>后台管理</h2><h3 id="后台布局"><a href="#后台布局" class="headerlink" title="后台布局"></a>后台布局</h3><p>后台布局css及layout文件：<a href="http://files.cnblogs.com/files/Python666/%E5%90%8E%E5%8F%B0%E5%B8%83%E5%B1%80%E6%96%87%E4%BB%B6.rar" target="_blank" rel="external">http://files.cnblogs.com/files/Python666/%E5%90%8E%E5%8F%B0%E5%B8%83%E5%B1%80%E6%96%87%E4%BB%B6.rar</a></p>
<h3 id="组合筛选"><a href="#组合筛选" class="headerlink" title="组合筛选"></a>组合筛选</h3><p>组合筛选的时候改造URL，参考：<a href="http://car.autohome.com.cn/" target="_blank" rel="external">http://car.autohome.com.cn/</a></p>
<p>在筛选的时候，不同的筛选条件在URL中作为不同的参数，通过GET请求发送到后台，后台还要发送回前端。</p>
<p><strong>1 把URL改造成：<a href="http://127.0.0.1:8000/articlemanage-1-0-0.html" target="_blank" rel="external">http://127.0.0.1:8000/articlemanage-1-0-0.html</a></strong></p>
<p><strong>2 URL路由</strong></p>
<p>使用关键字的方式进行正则匹配</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url(<span class="string">r'^articlemanage-(?P&lt;type_id&gt;\d+)-(?P&lt;category_id&gt;\d+)-(?P&lt;tags_is&gt;\d+).html$'</span>, views.articlemanage), <span class="comment"># 后台管理筛选页面</span></div></pre></td></tr></table></figure>
<p><strong>3 在后台的函数</strong></p>
<h4 id="在后台用-kwargs进行接收"><a href="#在后台用-kwargs进行接收" class="headerlink" title="在后台用**kwargs进行接收"></a>在后台用**kwargs进行接收</h4><p><code>def articlemanage(request,**kwargs):</code></p>
<ul>
<li>下面的筛选数据的关键是通过用户的session id ,这个在登录的时候存到session中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">articlemanage</span><span class="params">(request, **kwargs)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    后台文章管理</div><div class="line">    筛选文章</div><div class="line">    创建文章</div><div class="line">    :param request:</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    print(kwargs)</div><div class="line">    <span class="comment"># 大分类 在内存中，直接获取</span></div><div class="line">    type_list = models.Article.type_choices  <span class="comment"># 这个是存在类中的，不用objects</span></div><div class="line">    <span class="comment"># username = request.session.get('username')  # 获取当前登录用户</span></div><div class="line">    <span class="comment"># user_info = models.UserInfo.objects.filter(username=username).first()</span></div><div class="line">    <span class="comment"># user_id = user_info.nid  # 获得用户ID 这是连表获得的，效率低</span></div><div class="line">    user_id = request.session.get(<span class="string">'userid'</span>)  <span class="comment"># 从session中获取用户id</span></div><div class="line"></div><div class="line">    <span class="string">"""</span></div><div class="line">    Category表中有blog_id，是外键直接关联到blog表中的一行对象，实际上blog和userinfo是一一对应的关系</div><div class="line">    Tag表的关系和Category是一样的</div><div class="line">    """</div><div class="line">    <span class="comment"># 个人分类</span></div><div class="line">    category_list = models.Category.objects.filter(blog_id=user_id)  <span class="comment"># 从Category表中的blog_id进行过滤当前用户的</span></div><div class="line">    <span class="comment"># 个人标签</span></div><div class="line">    tag_list = models.Tag.objects.filter(blog_id=user_id)</div><div class="line">    <span class="comment"># 所有文章</span></div><div class="line">    article_list = models.Article.objects.filter(blog_id=user_id)</div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'articlemanage.html'</span>, &#123;</div><div class="line">        <span class="string">'type_list'</span>: type_list,</div><div class="line">        <span class="string">'category_list'</span>: category_list,</div><div class="line">        <span class="string">'tag_list'</span>: tag_list,</div><div class="line">        <span class="string">'article_list'</span>: article_list,</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>通过打印kwargs可以看到结果：</p>
<p>得到的结果是字典数据，分别代表分类的内容，后面的参数就代表的是选中的筛选条件的ID值，点击的时候通过GET进行发送<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&apos;type_id&apos;: &apos;1&apos;, &apos;category_id&apos;: &apos;0&apos;, &apos;tags_is&apos;: &apos;0&apos;&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>对接收的字典数据进行处理，默认的情况是选中全部的</li>
<li>对字典数据的处理用到了dict.items()</li>
<li>dict.items()会把字典数据转换成列表中，里面的元素是元组数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dict = &#123;<span class="string">'Google'</span>: <span class="string">'www.google.com'</span>, <span class="string">'Runoob'</span>: <span class="string">'www.runoob.com'</span>, <span class="string">'taobao'</span>: <span class="string">'www.taobao.com'</span>&#125;</div><div class="line"><span class="keyword">for</span> key,values <span class="keyword">in</span>  dict.items():</div><div class="line">    <span class="keyword">print</span> key,values</div><div class="line"></div><div class="line">字典值 : [(<span class="string">'Google'</span>, <span class="string">'www.google.com'</span>), (<span class="string">'taobao'</span>, <span class="string">'www.taobao.com'</span>), (<span class="string">'Runoob'</span>, <span class="string">'www.runoob.com'</span>)]</div><div class="line">Google www.google.com</div><div class="line">taobao www.taobao.com</div><div class="line">Runoob www.runoob.com</div></pre></td></tr></table></figure>
<h4 id="处理字典数据"><a href="#处理字典数据" class="headerlink" title="处理字典数据"></a>处理字典数据</h4><ul>
<li>0默认是全部</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">conditon = &#123;&#125;</div><div class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> kwargs.items():</div><div class="line">    <span class="keyword">if</span> v != <span class="string">'0'</span>:  <span class="comment"># 注意这里是字符串0 把没有选中的排除</span></div><div class="line">        conditon[k] = v</div><div class="line">print(conditon)</div></pre></td></tr></table></figure>
<ul>
<li>对待默认数据的处理</li>
</ul>
<p>通过conditon[‘blog_id’]= user_id 设置默认选择全部的情况  因为上面已经把0的情况全部删除了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> conditon[<span class="string">'blog_id'</span>]= user_id  <span class="comment"># 这是默认的情况 因为上面已经把0的情况全部删除了，只能不是0 的传输过来</span></div><div class="line">print(conditon)</div><div class="line">article_list = models.Article.objects.filter(**conditon)  <span class="comment"># 筛选后的进行接收</span></div></pre></td></tr></table></figure></p>
<h4 id="再看URL的正则匹配"><a href="#再看URL的正则匹配" class="headerlink" title="再看URL的正则匹配"></a>再看URL的正则匹配</h4><ul>
<li>下面的是正确的情况，修改之前的type_id和tags_id</li>
<li>article_type_id 是Article中的字段</li>
<li>tags是article中的M2M字段，而且有自己定义的第三张表 </li>
<li>有tags字段的时候，是自关联，tags<strong>nid  已经连到了第三张表Tag  使用tags</strong>nid即可</li>
<li>nid 是Tag表中的字段</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url(<span class="string">r'^articlemanage-(?P&lt;article_type_id&gt;\d+)-(?P&lt;category_id&gt;\d+)-(?P&lt;tags__nid&gt;\d+).html$'</span>, views.articlemanage), <span class="comment"># 后台管理筛选页面</span></div></pre></td></tr></table></figure>
<ul>
<li>如果Aticle中没有tags字段，就是使用反向关联，这个字段是声明自己创建的第三张表(M2M混合使用的时候) article2tag__tag_id</li>
<li><strong>用小写的表名就跨到了第三张表Article2Tag</strong>，Article2Tag中用字段tag_id,使用双下划线进行关联</li>
<li><strong>明确是从Aticle反向跨表到Article2Tag</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url(<span class="string">r'^articlemanage-(?P&lt;article_type_id&gt;\d+)-(?P&lt;category_id&gt;\d+)-(?P&lt;article2tag__tag_id&gt;\d+).html$'</span>, views.articlemanage), <span class="comment"># 后台管理筛选页面</span></div></pre></td></tr></table></figure>
<h4 id="自动获取URL，只改变本身，不修改其他"><a href="#自动获取URL，只改变本身，不修改其他" class="headerlink" title="自动获取URL，只改变本身，不修改其他"></a>自动获取URL，只改变本身，不修改其他</h4><ul>
<li>只改变本身，不修改其他的关键是kwargs的值传到前端，kwargs中的值有相应的value</li>
<li>后台kwargs中的value是字符串类型，在判断的时候需要转换成int</li>
</ul>
<p>第一个参数是自己的值，第二个是分类的值，第三个是标签的值，要和URL中传递的参数一一对应<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;a href="/articlemanage-&#123;&#123; type.0 &#125;&#125;-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"&gt;&#123;&#123; type.1 &#125;&#125;&lt;/a&gt;  &#123;# tyoe_choice是列表，通过0 获取的是索引 1获取的是名称 #&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"condition"</span>&gt;</span></div><div class="line">       总的分类:</div><div class="line">       &#123;% if kwargs.article_type_id == 0 %&#125;</div><div class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/articlemanage-0-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">       &#123;% else %&#125;</div><div class="line">           <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/articlemanage-0-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">       &#123;% endif %&#125;</div><div class="line">       &#123;% for type in type_list %&#125;</div><div class="line">           &#123;% if type.0 == kwargs.article_type_id %&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; type.0 &#125;&#125;-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>&#123;&#123; type.1 &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  &#123;# tyoe_choice是列表，通过0 获取的是索引 1获取的是名称 #&#125;</div><div class="line">           &#123;% else %&#125;</div><div class="line">               <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; type.0 &#125;&#125;-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>&#123;&#123; type.1 &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  &#123;# tyoe_choice是列表，通过0 获取的是索引 1获取的是名称 #&#125;</div><div class="line">           &#123;% endif %&#125;</div><div class="line">       &#123;% endfor %&#125;</div><div class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>kwargs[k] = int(v)  # 把字符串类型的转换成数字 最终kwargs是要返回前端</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">articlemanage</span><span class="params">(request, **kwargs)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    后台文章管理</div><div class="line">    筛选文章</div><div class="line">    创建文章</div><div class="line">    :param request:</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    print(kwargs)</div><div class="line">    condition = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> kwargs.items():</div><div class="line">        <span class="comment"># condition[k] = int(v)  # 把字符串类型的转换成数字</span></div><div class="line">        kwargs[k] = int(v)  <span class="comment"># 把字符串类型的转换成数字 最终kwargs是要返回前端</span></div><div class="line">        <span class="keyword">if</span> v != <span class="string">'0'</span>:  <span class="comment"># 注意这里是字符串0 把没有选中的排除</span></div><div class="line">            <span class="comment"># condition[k] = int(v)  # 把字符串类型的转换成数字</span></div><div class="line">            condition[k] = v</div><div class="line">    print(condition)</div><div class="line">    <span class="comment"># 大分类 在内存中，直接获取</span></div><div class="line">    type_list = models.Article.type_choices  <span class="comment"># 这个是存在类中的，不用objects</span></div><div class="line">    <span class="comment"># username = request.session.get('username')  # 获取当前登录用户</span></div><div class="line">    <span class="comment"># user_info = models.UserInfo.objects.filter(username=username).first()</span></div><div class="line">    <span class="comment"># user_id = user_info.nid  # 获得用户ID 这是连表获得的，效率低</span></div><div class="line">    user_id = request.session.get(<span class="string">'userid'</span>)  <span class="comment"># 从session中获取用户id</span></div><div class="line"></div><div class="line">    <span class="string">"""</span></div><div class="line">    Category表中有blog_id，是外键直接关联到blog表中的一行对象，实际上blog和userinfo是一一对应的关系</div><div class="line">    Tag表的关系和Category是一样的</div><div class="line">    """</div><div class="line">    <span class="comment"># 个人分类</span></div><div class="line">    category_list = models.Category.objects.filter(blog_id=user_id)  <span class="comment"># 从Category表中的blog_id进行过滤当前用户的</span></div><div class="line">    <span class="comment"># 个人标签</span></div><div class="line">    tag_list = models.Tag.objects.filter(blog_id=user_id)</div><div class="line">    <span class="comment"># 所有文章</span></div><div class="line">    condition[<span class="string">'blog_id'</span>]= user_id  <span class="comment"># 这是默认的情况 因为上面已经把0的情况全部删除了，只能不是0 的传输过来</span></div><div class="line">    print(condition)</div><div class="line">    article_list = models.Article.objects.filter(**condition)  <span class="comment"># 筛选后的进行接收</span></div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'articlemanage.html'</span>, &#123;</div><div class="line">        <span class="string">'type_list'</span>: type_list,</div><div class="line">        <span class="string">'category_list'</span>: category_list,</div><div class="line">        <span class="string">'tag_list'</span>: tag_list,</div><div class="line">        <span class="string">'article_list'</span>: article_list,</div><div class="line">        <span class="string">'kwargs'</span>:kwargs,  <span class="comment"># 把kwargs中的数据传回前端</span></div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>前端</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">&#123;% extends 'layout.html' %&#125;</div><div class="line"></div><div class="line">&#123;% block css %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/css/articlemanage.css"</span>&gt;</span></div><div class="line">&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block content %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>筛选<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"condition"</span>&gt;</span></div><div class="line">        总的分类:</div><div class="line">        &#123;% if kwargs.article_type_id == 0 %&#125;</div><div class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/articlemanage-0-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        &#123;% else %&#125;</div><div class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/articlemanage-0-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        &#123;% endif %&#125;</div><div class="line">        &#123;% for type in type_list %&#125;</div><div class="line">            &#123;% if type.0 == kwargs.article_type_id %&#125;</div><div class="line">                 <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; type.0 &#125;&#125;-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>&#123;&#123; type.1 &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  &#123;# tyoe_choice是列表，通过0 获取的是索引 1获取的是名称 #&#125;</div><div class="line">            &#123;% else %&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; type.0 &#125;&#125;-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>&#123;&#123; type.1 &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  &#123;# tyoe_choice是列表，通过0 获取的是索引 1获取的是名称 #&#125;</div><div class="line">            &#123;% endif %&#125;</div><div class="line">        &#123;% endfor %&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"condition"</span>&gt;</span></div><div class="line">        个人分类:</div><div class="line">        &#123;% if kwargs.category_id == 0 %&#125;</div><div class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; kwargs.article_type_id &#125;&#125;-0-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        &#123;% else %&#125;</div><div class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; kwargs.article_type_id &#125;&#125;-0-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        &#123;% endif %&#125;</div><div class="line">        &#123;% for category in category_list %&#125;</div><div class="line">            &#123;% if kwargs.category_id == category.nid %&#125;</div><div class="line">                  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; kwargs.article_type_id &#125;&#125;-&#123;&#123; category.nid &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>&#123;&#123; category.title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  &#123;# tyoe_choice是列表，通过0 获取的是索引 1获取的是名称 #&#125;</div><div class="line">            &#123;% else %&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; kwargs.article_type_id &#125;&#125;-&#123;&#123; category.nid &#125;&#125;-&#123;&#123; kwargs.tags__nid &#125;&#125;.html"</span>&gt;</span>&#123;&#123; category.title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  &#123;# tyoe_choice是列表，通过0 获取的是索引 1获取的是名称 #&#125;</div><div class="line">            &#123;% endif %&#125;</div><div class="line">        &#123;% endfor %&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"condition"</span>&gt;</span></div><div class="line">        个人标签:</div><div class="line">        &#123;% if kwargs.tags__nid == 0 %&#125;</div><div class="line">             <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; kwargs.article_type_id &#125;&#125;-&#123;&#123; kwargs.category_id &#125;&#125;-0.html"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        &#123;% else %&#125;</div><div class="line">             <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; kwargs.article_type_id &#125;&#125;-&#123;&#123; kwargs.category_id &#125;&#125;-0.html"</span>&gt;</span>全部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        &#123;% endif %&#125;</div><div class="line">        &#123;% for tag in tag_list %&#125;</div><div class="line">            &#123;% if kwargs.tags__nid == tag.nid %&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"active"</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; kwargs.article_type_id &#125;&#125;-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; tag.nid &#125;&#125;.html"</span>&gt;</span>&#123;&#123; tag.title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  &#123;# tyoe_choice是列表，通过0 获取的是索引 1获取的是名称 #&#125;</div><div class="line">            &#123;% else %&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/articlemanage-&#123;&#123; kwargs.article_type_id &#125;&#125;-&#123;&#123; kwargs.category_id &#125;&#125;-&#123;&#123; tag.nid &#125;&#125;.html"</span>&gt;</span>&#123;&#123; tag.title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  &#123;# tyoe_choice是列表，通过0 获取的是索引 1获取的是名称 #&#125;</div><div class="line">            &#123;% endif %&#125;</div><div class="line">        &#123;% endfor %&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>文章<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">    &#123;% for article in article_list %&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>&#123;&#123; article.title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; article.summary &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    &#123;% endfor %&#125;</div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<p><strong>使用SimpleTag写成模板函数</strong></p>
<h3 id="文章编辑页面"><a href="#文章编辑页面" class="headerlink" title="文章编辑页面"></a>文章编辑页面</h3><p>KindEditor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div></pre></td><td class="code"><pre><div class="line">Bootstrap 导航条</div><div class="line">修改 css radius=0  !important</div><div class="line"></div><div class="line">栅格 左右划分</div><div class="line">col-md-8</div><div class="line"></div><div class="line">头像浮动 left</div><div class="line"></div><div class="line"></div><div class="line">clearfix 清除浮动  相当于在后面 加上了 div中的clear both</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">文章筛选：</div><div class="line">PYthon Linux ...</div><div class="line"></div><div class="line">	从URL进行修改</div><div class="line">	 全部</div><div class="line">	 Python</div><div class="line">	 Linux</div><div class="line"></div><div class="line">  选中的</div><div class="line"></div><div class="line">获取当前URL</div><div class="line">request.path_info</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">登录界面</div><div class="line"></div><div class="line">name属性</div><div class="line"></div><div class="line"></div><div class="line">col-sm-5宽度</div><div class="line"></div><div class="line">验证码的本质是Django从硬盘读取到文件</div><div class="line"></div><div class="line">读取的时候用rb,HTTPresponse返回</div><div class="line"></div><div class="line">Pillow创建图片</div><div class="line">图片对象</div><div class="line"></div><div class="line"></div><div class="line">验证码直接用，不存放硬盘</div><div class="line"></div><div class="line">from io import BytesIO</div><div class="line"></div><div class="line">在内存开辟空间</div><div class="line"></div><div class="line">画图</div><div class="line"></div><div class="line">	点</div><div class="line">	线</div><div class="line">	原型</div><div class="line">	字体</div><div class="line">		特殊字体</div><div class="line"></div><div class="line"> v = random.randint()</div><div class="line"> chr(v)</div><div class="line"></div><div class="line"> 把验证码保存在session中</div><div class="line"></div><div class="line"></div><div class="line">  头像在浏览器上预览</div><div class="line">	- window.url</div><div class="line">	- </div><div class="line">forms 单独写一个文件</div><div class="line"></div><div class="line"></div><div class="line">自己在form的类中自定义</div><div class="line"></div><div class="line">通过构造方法，封装 request</div><div class="line">self.__init():</div><div class="line"></div><div class="line">super()</div><div class="line"></div><div class="line"></div><div class="line">两个验证码放在clean中</div><div class="line"></div><div class="line">两次不一致最后的错误信息</div><div class="line"></div><div class="line">clean的错误放在__all__ 公共的错误</div><div class="line"></div><div class="line">obj.errors.__all__  后台可以取</div><div class="line">但是前端不支持下划线</div><div class="line"></div><div class="line"></div><div class="line">NON_FIELD_ERRORS  后台可以取</div><div class="line"></div><div class="line">前端用小写的**obj.non_field_errors**,没有errors</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">自己主动对某一字段抛出异常</div><div class="line">self.add_error(&quot;字段名&quot;，Validationerror)</div><div class="line"></div><div class="line"></div><div class="line">验证码点击刷新</div><div class="line"></div><div class="line">在utl后面加？刷新  图片名字title ：点击刷新</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">每个人的个人主页是不用登陆</div><div class="line"></div><div class="line"></div><div class="line">一对一</div><div class="line"></div><div class="line">正向 反向和FK一致</div><div class="line"></div><div class="line">反向还可以直接找</div><div class="line"></div><div class="line"></div><div class="line">### 博客个人分类</div><div class="line"></div><div class="line"></div><div class="line">annotate聚合函数需要导入</div><div class="line"></div><div class="line">values+annotate 实现group by</div><div class="line"></div><div class="line">双下划线跨表操作</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#### 标签分类</div><div class="line"></div><div class="line">标签和文章是多对多的关系</div><div class="line"></div><div class="line"></div><div class="line">组合搜索</div><div class="line">   在URL中定义 </div><div class="line"></div><div class="line">   M2M有第三张表的时候，自动跨了tags</div><div class="line">   前后端的类型转化 字符串和</div><div class="line">   </div><div class="line">kindEditor</div><div class="line"></div><div class="line">   items定制功能</div><div class="line">   HTMLtag安全 只能是前端过滤</div><div class="line">   还需要后台后台过滤</div><div class="line">   resizeType 0 不拖动</div><div class="line">   uploadJson：上传文件</div><div class="line">   上传图片：</div><div class="line">       csrf</div><div class="line"></div><div class="line">       上传完成后。。</div><div class="line">    imgFile  名字是固定的  本质是iframe+form  伪Ajax  可以修改</div><div class="line"></div><div class="line"></div><div class="line">    过滤</div><div class="line">    beautifulsoup4</div><div class="line">    把标签转换成对象</div><div class="line"></div><div class="line">    find_all</div><div class="line">    白名单</div><div class="line">    decomose删除标签</div><div class="line">    标签的属性</div><div class="line"></div><div class="line">    **字典的keys()**</div><div class="line">    items()</div><div class="line"></div><div class="line">    ？？？构造方法  day78</div><div class="line">        在Formmanage中</div><div class="line">    	修复Bug，刷新无法动态显示数据库内容：</div><div class="line">				方式一：</div><div class="line">					class TeacherForm(Form):</div><div class="line">						tname = fields.CharField(min_length=2)</div><div class="line">						# xx = form_model.ModelMultipleChoiceField(queryset=models.Classes.objects.all())</div><div class="line">						# xx = form_model.ModelChoiceField(queryset=models.Classes.objects.all())</div><div class="line"></div><div class="line">				方式二：</div><div class="line">					class TeacherForm(Form):</div><div class="line">						tname = fields.CharField(min_length=2)</div><div class="line"></div><div class="line">						xx = fields.MultipleChoiceField(</div><div class="line">							widget=widgets.SelectMultiple</div><div class="line">						)</div><div class="line">						def __init__(self,*args,**kwargs):</div><div class="line">							super(TeacherForm,self).__init__(*args,**kwargs)</div><div class="line">							self.fields[&apos;xx&apos;].widget.choices = models.Classes.objects.values_list(&apos;id&apos;,&apos;title&apos;)</div><div class="line"></div><div class="line"></div><div class="line">前端多级评论</div><div class="line"></div><div class="line">    前端的String 格式化字符串 prototype</div><div class="line">    自己定义一个格式化函数js的</div><div class="line">    replace(/正则/,)</div><div class="line">    replace(/\&#123;\w+\&#125;/,)</div><div class="line">    replace(/正则/g,) 全部的</div><div class="line">    分组（）</div><div class="line">    每找到一个，就执行函数 并且有返回值</div><div class="line">    </div><div class="line">    前端对象的方法在protoType中</div><div class="line">    可以写扩展</div><div class="line">    前端正则表达式</div><div class="line"></div><div class="line"></div><div class="line">权限管理</div><div class="line"></div><div class="line">role </div><div class="line"></div><div class="line">related_name的知识点</div><div class="line"></div><div class="line">role__in=role_list</div><div class="line"></div><div class="line">去重</div><div class="line">distinct </div><div class="line">annotate会加上一列c</div><div class="line"></div><div class="line">权限放在session中，判断URL和方法是否在session</div><div class="line"></div><div class="line"></div><div class="line">request.path_info只能获得一部分路径</div><div class="line"></div><div class="line">验证的请求在中间件进行验证</div><div class="line"></div><div class="line">建立白名单</div><div class="line"></div><div class="line">权限中可以写正则</div><div class="line"></div><div class="line">re.match()</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li></ul>

      
        
	<div id="comment">
	
	<!-- 多说评论框 start -->
	 <div class="ds-thread" data-thread-key="/2017/07/10/博客项目文档/" data-title="Django博客项目" data-url="https://github.com/ythzx/ythzx.github.io/2017/07/10/博客项目文档/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"ythzx"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0] 
	     || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
	  </script>
	<!-- 多说公共JS代码 end -->
	
	</div>
	<link rel="stylesheet" href="/css/comment.css">


      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/07/10/多表操作/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          Django models多表操作
        
      </div>
    </a>
  
  
    <a href="/2017/07/09/Form组件的扩展 钩子/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">Form组件的验证流程及扩展(钩子)</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Django博客项目"><span class="nav-number">1.</span> <span class="nav-text">Django博客项目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置静态文件"><span class="nav-number">1.1.</span> <span class="nav-text">配置静态文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库MySQL"><span class="nav-number">1.2.</span> <span class="nav-text">数据库MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置setting"><span class="nav-number">1.2.1.</span> <span class="nav-text">配置setting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置成pymysql进行连接及MySQL"><span class="nav-number">1.2.2.</span> <span class="nav-text">配置成pymysql进行连接及MySQL</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#models-设计表的结构"><span class="nav-number">1.3.</span> <span class="nav-text">models 设计表的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#在modles中创建"><span class="nav-number">1.3.1.</span> <span class="nav-text">在modles中创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成表"><span class="nav-number">1.3.2.</span> <span class="nav-text">生成表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#页面"><span class="nav-number">1.4.</span> <span class="nav-text">页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-导航条"><span class="nav-number">1.4.1.</span> <span class="nav-text">1 导航条</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#修改导航条两侧间距"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">修改导航条两侧间距</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改Bootstrap的整体圆角"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">修改Bootstrap的整体圆角</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改导航条的分类"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">修改导航条的分类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-下部文章用栅格分开"><span class="nav-number">1.4.2.</span> <span class="nav-text">2 下部文章用栅格分开</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-左侧内容"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">2.1 左侧内容</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#从后台数据查询文章表的信息，然后传递给后台"><span class="nav-number">1.4.2.1.1.</span> <span class="nav-text">从后台数据查询文章表的信息，然后传递给后台</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#对文章内容进行筛选"><span class="nav-number">1.4.2.1.2.</span> <span class="nav-text">对文章内容进行筛选</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-右侧内容"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">2.2 右侧内容</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#登录界面"><span class="nav-number">1.4.3.</span> <span class="nav-text">登录界面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#验证功能"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">验证功能</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#画点"><span class="nav-number">1.4.3.1.1.</span> <span class="nav-text">画点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#画线"><span class="nav-number">1.4.3.1.2.</span> <span class="nav-text">画线</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#画圆"><span class="nav-number">1.4.3.1.3.</span> <span class="nav-text">画圆</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#写文字及字体"><span class="nav-number">1.4.3.1.4.</span> <span class="nav-text">写文字及字体</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册页面"><span class="nav-number">1.4.4.</span> <span class="nav-text">注册页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Form组件"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">Form组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#验证码验证-并点击刷新验证码"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">验证码验证 并点击刷新验证码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#头像预览"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">头像预览</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#上传头像的默认地址设置"><span class="nav-number">1.4.4.4.</span> <span class="nav-text">上传头像的默认地址设置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#window-URL-createObjectURL"><span class="nav-number">1.4.4.4.1.</span> <span class="nav-text">window.URL.createObjectURL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#readAsDataURL"><span class="nav-number">1.4.4.4.2.</span> <span class="nav-text">readAsDataURL</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-通过从页面获取csrfmiddlewaretoken-在数据中发送"><span class="nav-number">1.4.4.5.</span> <span class="nav-text">1 通过从页面获取csrfmiddlewaretoken,在数据中发送</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-使用jquery-cookie-js-把-X-CSRFToken写请求头进行发送"><span class="nav-number">1.4.4.6.</span> <span class="nav-text">2 使用jquery.cookie.js 把 X-CSRFToken写请求头进行发送</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#个人页面"><span class="nav-number">1.4.5.</span> <span class="nav-text">个人页面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#分类"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#标签"><span class="nav-number">1.4.5.2.</span> <span class="nav-text">标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#时间"><span class="nav-number">1.4.5.3.</span> <span class="nav-text">时间</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#详细页面-文章最终页"><span class="nav-number">1.4.6.</span> <span class="nav-text">详细页面(文章最终页)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#详细内容"><span class="nav-number">1.4.6.1.</span> <span class="nav-text">详细内容</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#点赞"><span class="nav-number">1.4.6.2.</span> <span class="nav-text">点赞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#评论"><span class="nav-number">1.4.6.3.</span> <span class="nav-text">评论</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Django-admin的后台管理"><span class="nav-number">1.4.7.</span> <span class="nav-text">Django admin的后台管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建superuser用户"><span class="nav-number">1.4.7.1.</span> <span class="nav-text">创建superuser用户</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#后台管理"><span class="nav-number">1.5.</span> <span class="nav-text">后台管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#后台布局"><span class="nav-number">1.5.1.</span> <span class="nav-text">后台布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组合筛选"><span class="nav-number">1.5.2.</span> <span class="nav-text">组合筛选</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在后台用-kwargs进行接收"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">在后台用**kwargs进行接收</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#处理字典数据"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">处理字典数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#再看URL的正则匹配"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">再看URL的正则匹配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自动获取URL，只改变本身，不修改其他"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">自动获取URL，只改变本身，不修改其他</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文章编辑页面"><span class="nav-number">1.5.3.</span> <span class="nav-text">文章编辑页面</span></a></li></ol></li></ol></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2017 Peter&#39;s Blog Center All Rights Reserved.
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>






<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?93b40df12317201527431272f20ac28a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
  

  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


  <script type="text/javascript" color="33,33,33" zindex="-1" opacity="1" count="80" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
