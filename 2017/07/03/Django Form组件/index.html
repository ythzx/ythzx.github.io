<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>django form组件 | Peter&#39;s Blog Center</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="Django" />
  
  
  
  
  <meta name="description" content="From的功能实际有三个，Form验证，From添加标签，Form保留返回值
保留返回值的功能还可用ajax发送
一、Form验证">
<meta property="og:type" content="article">
<meta property="og:title" content="Django Form组件">
<meta property="og:url" content="https://github.com/ythzx/ythzx.github.io/2017/07/03/Django Form组件/index.html">
<meta property="og:site_name" content="Peter's Blog Center">
<meta property="og:description" content="From的功能实际有三个，Form验证，From添加标签，Form保留返回值
保留返回值的功能还可用ajax发送
一、Form验证">
<meta property="og:updated_time" content="2017-07-09T04:34:32.914Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Django Form组件">
<meta name="twitter:description" content="From的功能实际有三个，Form验证，From添加标签，Form保留返回值
保留返回值的功能还可用ajax发送
一、Form验证">
  
    <link rel="alternate" href="/atom.xml" title="Peter&#39;s Blog Center" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >
  <link rel="stylesheet" href="/css/hiero.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Peter&#39;s Blog Center" rel="home"> Peter&#39;s Blog Center </a>
            
          </h1>

          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">首页</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">归档</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/categories">分类</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">标签</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">关于</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>




  <div id="container" style='background: rgba(255,255,255,0.5);'>
    <div id="wrap" style='background: rgba(255,255,255,0.5);'>
            
      <div id="content" class="outer" style='background: rgba(255,255,255,0.5);'>
        
          <section id="main" style="float:none;"><article id="post-Django Form组件" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Django Form组件
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2017/07/03/Django Form组件/" class="article-date">
	  <time datetime="2017-07-03T15:24:04.203Z" itemprop="datePublished">七月 3, 2017</time>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>From的功能实际有三个，Form验证，From添加标签，Form保留返回值</p>
<p>保留返回值的功能还可用ajax发送</p>
<h3 id="一、Form验证"><a href="#一、Form验证" class="headerlink" title="一、Form验证"></a>一、Form验证</h3><a id="more"></a>
<p>对用户的请求的数据进行验证</p>
<p>使用类</p>
<p>从前端获取的数据的name属性的名字要和定义的class类中的字段一致</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h3 id="二、From添加标签"><a href="#二、From添加标签" class="headerlink" title="二、From添加标签"></a>二、From添加标签</h3><h4 id="1-自己在前端写标签"><a href="#1-自己在前端写标签" class="headerlink" title="1 自己在前端写标签"></a>1 自己在前端写标签</h4><p>自己在前端写input标签，在提交后在后台获取name属性的值进行验证，<strong>user要和LoginForm 中的字段名一致</strong>，<br>之后obj.is_valid()会自动验证，验证通过(通过后正确信息是obj.cleaned_data,<br>)，返回True，不通过返回false(错误信息obj.errors),通常在前端获取，如<code>obj.errors.user.0</code></p>
<p>这里的问题是提交后不能保存信息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"f1"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"/login/"</span>&gt;</span></div><div class="line">    &#123;% csrf_token %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">        用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span>&#123;&#123; obj.errors.user.0&#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span>&gt;</span>&#123;&#123; obj.errors.pwd.0 &#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">"submitForm();"</span>&gt;</span>ajax提交<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="2-Form在前端生成标签"><a href="#2-Form在前端生成标签" class="headerlink" title="2 Form在前端生成标签"></a>2 Form在前端生成标签</h4><p>在前端生成的关键是在提交GET请求的时候传递obj到前端，这个obj是LoginForm实例化的对象，<strong>内部不加参数</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        obj = LoginForm()   <span class="comment"># 此处的obj不加参数</span></div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        obj = LoginForm(request.POST)</div><div class="line">        <span class="keyword">if</span> obj.is_valid():</div><div class="line">            print(obj.cleaned_data)</div><div class="line">            <span class="keyword">return</span> redirect(<span class="string">'http://www.baidu.com'</span>)</div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div></pre></td></tr></table></figure>
<p>前端代码</p>
<p>第一个obj.user是Form生成的标签，第二个是post请求显示的错误信息<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"f1"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"/login/"</span>&gt;</span></div><div class="line">    &#123;% csrf_token %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">        用户名：&#123;&#123; obj.user &#125;&#125;&#123;&#123; obj.errors.user.0&#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">        密码：&#123;&#123; obj.pwd &#125;&#125;&#123;&#123; obj.errors.pwd.0 &#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">onclick</span>=<span class="string">"submitForm();"</span>&gt;</span>ajax提交<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="三、Form保留返回值"><a href="#三、Form保留返回值" class="headerlink" title="三、Form保留返回值"></a>三、Form保留返回值</h3><p>通过from生成标签能够保留表单已经填的通过验证的信息，不能验证通过的不保留</p>
<p>密码的位置加上了<code>widget=widgets.PasswordInput()</code>，输入的密码就是隐藏的</p>
<p><strong>1 定义Form类，继承Form</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect, HttpResponse</div><div class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> Form</div><div class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> fields</div><div class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> widgets</div><div class="line"></div><div class="line"><span class="keyword">import</span> json</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span><span class="params">(Form)</span>:</span></div><div class="line">    user = fields.CharField(</div><div class="line">        max_length=<span class="number">18</span>,</div><div class="line">        min_length=<span class="number">6</span>,</div><div class="line">        required=<span class="keyword">True</span>,</div><div class="line">        error_messages=&#123;</div><div class="line">            <span class="string">'max_length'</span>: <span class="string">'用户名太长了'</span>,</div><div class="line">            <span class="string">'min_length'</span>: <span class="string">'用户名太短了'</span>,</div><div class="line">            <span class="string">'required'</span>: <span class="string">'用户名不能为空'</span>,</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">    )</div><div class="line">    pwd = fields.CharField(</div><div class="line">        min_length=<span class="number">16</span>,</div><div class="line">        required=<span class="keyword">True</span>,</div><div class="line">        error_messages=&#123;</div><div class="line">            <span class="string">'min_length'</span>: <span class="string">'密码太短了'</span>,</div><div class="line">            <span class="string">'required'</span>: <span class="string">'密码不能为空'</span>,</div><div class="line">        &#125;,</div><div class="line">        widget=widgets.PasswordInput(),  <span class="comment"># 密码格式，将输入的内容隐藏</span></div><div class="line">    )</div></pre></td></tr></table></figure></p>
<p><strong>2 GET请求和POST请求都发送obj</strong></p>
<p>GET请求的时候需要实例化一个对象<code>obj = LoginForm()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        obj = LoginForm()   <span class="comment"># 此处的obj不加参数     </span></div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        obj = LoginForm(request.POST)</div><div class="line">        <span class="keyword">if</span> obj.is_valid():</div><div class="line">            print(obj.cleaned_data)</div><div class="line">            <span class="keyword">return</span> redirect(<span class="string">'http://www.baidu.com'</span>)</div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div></pre></td></tr></table></figure>
<p><strong>3 前端</strong></p>
<p>现在的浏览器默认会在前端进行验证，在测试的时候加上<strong>novalidate</strong>，之后删除</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"f1"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"/login/"</span> <span class="attr">novalidate</span>&gt;</span></div><div class="line">    &#123;% csrf_token %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">        用户名：&#123;&#123; obj.user &#125;&#125;&#123;&#123; obj.errors.user.0&#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">        密码：&#123;&#123; obj.pwd &#125;&#125;&#123;&#123; obj.errors.pwd.0 &#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="ajax保留返回值"><a href="#ajax保留返回值" class="headerlink" title="ajax保留返回值"></a>ajax保留返回值</h3><h4 id="1-后台代码"><a href="#1-后台代码" class="headerlink" title="1 后台代码"></a>1 后台代码</h4><p>关键点：</p>
<ul>
<li>设置字典，没有通过验证把status设置成false并把obj.errors通过json发送到后台</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ajax_login</span><span class="params">(request)</span>:</span></div><div class="line">    ret = &#123;<span class="string">'status'</span>: <span class="keyword">True</span>, <span class="string">'msg'</span>: <span class="keyword">None</span>&#125;</div><div class="line">    obj = LoginForm(request.POST)</div><div class="line">    <span class="keyword">if</span> obj.is_valid():</div><div class="line">        print(obj.cleaned_data)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="comment"># print(obj.errors)</span></div><div class="line">        ret[<span class="string">'status'</span>] = <span class="keyword">False</span></div><div class="line">        ret[<span class="string">'msg'</span>] = obj.errors</div><div class="line">    v = json.dumps(ret)  <span class="comment"># 把错误的数据发送到后台</span></div><div class="line">    <span class="keyword">return</span> HttpResponse(v)</div></pre></td></tr></table></figure>
<h4 id="2-前端代码"><a href="#2-前端代码" class="headerlink" title="2 前端代码"></a>2 前端代码</h4><ul>
<li>在绑定事件的a标签上不要加href，自己点击的时候会默认刷新</li>
<li>点击的时候清除上一次的错误信息</li>
<li>ajax的data发送的的时候会把字典打包成字符串。通过ajax的serialize<br>打包获取数据</li>
<li>错误信息的内容是通过字符串拼接</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"f1"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"/login/"</span> <span class="attr">novalidate</span>&gt;</span></div><div class="line">    &#123;% csrf_token %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">        用户名：&#123;&#123; obj.user &#125;&#125;&#123;&#123; obj.errors.user.0&#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">        密码：&#123;&#123; obj.pwd &#125;&#125;&#123;&#123; obj.errors.pwd.0 &#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">"submitForm();"</span>&gt;</span>ajax提交<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-3.2.1.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">submitForm</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        $(<span class="string">'.c1'</span>).remove();<span class="comment">//每次点击清除上一次的错误信息</span></div><div class="line">        $.ajax(&#123;</div><div class="line">            <span class="attr">url</span>: <span class="string">'/ajax_login/'</span>,</div><div class="line">            <span class="attr">type</span>: <span class="string">'POST'</span>,</div><div class="line">            <span class="attr">data</span>: $(<span class="string">'#f1'</span>).serialize(),<span class="comment">//获取form的所有数据并打包 包含了csrf的随机字符串</span></div><div class="line">            dataType: <span class="string">'JSON'</span>,</div><div class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">arg</span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(arg);</div><div class="line">                <span class="keyword">if</span> (arg.status) &#123;</div><div class="line"></div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    $.each(arg.msg, <span class="function"><span class="keyword">function</span> (<span class="params">index, value</span>) </span>&#123;</div><div class="line">                        <span class="built_in">console</span>.log(index, value);</div><div class="line">                        <span class="keyword">var</span> tag = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>);</div><div class="line">                        tag.innerHTML = value[<span class="number">0</span>];</div><div class="line">                        tag.className = <span class="string">'c1'</span>;<span class="comment">//给错误信息添加class</span></div><div class="line">                        $(<span class="string">'#f1'</span>).find(<span class="string">'input[name="'</span> + index + <span class="string">'"]'</span>).after(tag);</div><div class="line">                        <span class="comment">/*拼接字符串*/</span></div><div class="line">                    &#125;)</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="四、使用form实现学生、班级、教师管理"><a href="#四、使用form实现学生、班级、教师管理" class="headerlink" title="四、使用form实现学生、班级、教师管理"></a>四、使用form实现学生、班级、教师管理</h3><h4 id="1-班级管理"><a href="#1-班级管理" class="headerlink" title="1 班级管理"></a>1 班级管理</h4><p><strong>1.1 班级form验证</strong> </p>
<p>班级的名字以班级开头 后面加数字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect, HttpResponse</div><div class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> Form</div><div class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> fields</div><div class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> widgets</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassForm</span><span class="params">(Form)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    添加班级的验证规则 以班级开头</div><div class="line">    """</div><div class="line">    title = fields.RegexField(<span class="string">'班级\d+'</span>)  <span class="comment"># 这个名字和数据库的字段名一致</span></div></pre></td></tr></table></figure>
<p><strong> 1.2 班级列表</strong></p>
<p>从数据库获取班级的全部信息，并发送到前端页面<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">class_list</span><span class="params">(request)</span>:</span></div><div class="line">    cls_list = models.Classes.objects.all()</div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'class_list.html'</span>, &#123;<span class="string">'cls_list'</span>: cls_list&#125;)</div></pre></td></tr></table></figure></p>
<p>班级列表前端是直接循环列出班级列表，row.title</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>班级列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/add_class/"</span>&gt;</span>添加班级<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">       &#123;% for row in cls_list %&#125;</div><div class="line">           <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; row.title &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>   </div><div class="line">       &#123;% endfor %&#125;</div><div class="line"></div><div class="line">   <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>1.3 添加班级列表</strong></p>
<ul>
<li>obj = ClassForm()  # 创建标签</li>
<li>通过验证后 obj.cleaned_data 是字典类型</li>
<li>开始定义和数据库中的字段名字一致，直接在下面用**对字典的数据进行接收</li>
<li>没有通过验证返回错误的信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_class</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        obj = ClassForm()  <span class="comment"># 创建标签</span></div><div class="line">        <span class="keyword">return</span> render(request,<span class="string">'add_class.html'</span>,&#123;<span class="string">'obj'</span>:obj&#125;)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        obj = ClassForm(request.POST)</div><div class="line">        <span class="keyword">if</span> obj.is_valid():</div><div class="line">            <span class="string">"""</span></div><div class="line">            通过验证后 obj.cleaned_data 是字典类型</div><div class="line">            在数据库添加一条数据</div><div class="line">            models.Classes.objects.create(title=obj.cleaned_data['xxx'])</div><div class="line">            如果字段的名字是xxx 就需要自己去取出来</div><div class="line">            所以开始定义和数据库中的字段名字一致，直接在下面用**对字典的数据进行接收</div><div class="line">            """</div><div class="line">            print(obj.cleaned_data)</div><div class="line">            models.Classes.objects.create(**obj.cleaned_data)  <span class="comment"># 使用**接收</span></div><div class="line">            <span class="keyword">return</span> redirect(<span class="string">'/class_list/'</span>)</div><div class="line">        <span class="keyword">return</span> render(request,<span class="string">'add_class.html'</span>,&#123;<span class="string">'obj'</span>:obj&#125;)   <span class="comment">#  没有通过验证返回错误的信息</span></div></pre></td></tr></table></figure>
<p>前端：</p>
<ul>
<li>obj.title 创建标签</li>
<li>obj.errors.title.0 显示错误信息</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>添加班级<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"/add_class/"</span>&gt;</span></div><div class="line">        &#123;% csrf_token %&#125;</div><div class="line">        &#123;&#123; obj.title &#125;&#125; &#123;&#123; obj.errors.title.0 &#125;&#125;</div><div class="line">        &#123;# &#123;&#123; obj &#125;&#125;#&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>1.4 编辑班级</strong></p>
<ul>
<li>url 中的正则加上(\d+)</li>
<li>页面的nid 是通过在class_list上点击的时候获取的,把row.id传递</li>
<li><code>&lt;a class=&quot;btn btn-primary&quot; href=&quot;/edit_class/&quot;&gt;编辑&lt;/a&gt;</code></li>
<li>在后台函数中用参数nid进行接收</li>
<li>使用initial进行参数传递</li>
<li>编辑是用update对数据库进行更新</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_class</span><span class="params">(request, nid)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    nid 负责接收 class页面中的row.id中的值</div><div class="line">    在URL中设置edit_class/(\d+)/</div><div class="line">    :param request:</div><div class="line">    :param nid:</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        row = models.Classes.objects.filter(id=nid).first()</div><div class="line">        <span class="comment"># obj = ClassForm(initial=&#123;'title': row.title&#125;)  # 这里是显示默认值 默认的是data 会进行验证 initial 不会进行验证</span></div><div class="line">        obj = ClassForm(initial=&#123;<span class="string">'title'</span>: row.title&#125;)</div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'edit_class.html'</span>, &#123;<span class="string">'nid'</span>: nid, <span class="string">'obj'</span>: obj&#125;)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        obj = ClassForm(request.POST)</div><div class="line">        <span class="keyword">if</span> obj.is_valid():</div><div class="line">            models.Classes.objects.filter(id=nid).update(**obj.cleaned_data)</div><div class="line">            <span class="keyword">return</span> redirect(<span class="string">'/class_list/'</span>)</div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'edit_class.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div></pre></td></tr></table></figure>
<h4 id="2-学生管理"><a href="#2-学生管理" class="headerlink" title="2 学生管理"></a>2 学生管理</h4><p><strong>2.1学生管理的后端</strong></p>
<ul>
<li>单选的时候用的而是插件Select中的choice</li>
<li>choice中的参数是列表，列表中的元素是元组</li>
<li>value_list操作中获得是元组对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentForm</span><span class="params">(Form)</span>:</span></div><div class="line">    name = fields.CharField(</div><div class="line">        min_length=<span class="number">2</span>,</div><div class="line">        max_length=<span class="number">6</span>,</div><div class="line">        <span class="comment"># widget = widgets.TextInput(attr)</span></div><div class="line">    )</div><div class="line">    email = fields.EmailField()</div><div class="line">    age = fields.IntegerField(min_value=<span class="number">18</span>, max_value=<span class="number">100</span>)</div><div class="line">    cls_id = fields.IntegerField(</div><div class="line">        <span class="comment"># widget = widgets.Select(choices=[(1,'上海'),(1,'北京')])  # choices = 列表的内部是元组的形式</span></div><div class="line">        widget=widgets.Select(choices=models.Classes.objects.values_list(<span class="string">'id'</span>, <span class="string">'title'</span>))</div><div class="line">        <span class="comment"># choice 是应用于单选 value_list 获取的就是列表中有元组</span></div><div class="line">        <span class="comment"># 注意此处有bug 添加班级后在这里没有新添加的班级，下面进行修复</span></div><div class="line">    )</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">student_list</span><span class="params">(request)</span>:</span></div><div class="line">    stu_list = models.Students.objects.all()</div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'student_list.html'</span>, &#123;<span class="string">'stu_list'</span>: stu_list&#125;)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_student</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        obj = StudentForm()</div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'add_student.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        obj = StudentForm(request.POST)</div><div class="line">        <span class="keyword">if</span> obj.is_valid():</div><div class="line">            models.Students.objects.create(**obj.cleaned_data)</div><div class="line">            <span class="keyword">return</span> redirect(<span class="string">'/student_list/'</span>)</div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'add_student.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div></pre></td></tr></table></figure>
<p><strong>BUG修复 动态更新数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">cls_id = fields.IntegerField(</div><div class="line">        <span class="comment"># widget = widgets.Select(choices=[(1,'上海'),(1,'北京')])  # choices = 列表的内部是元组的形式</span></div><div class="line">        <span class="comment"># widget=widgets.Select(choices=models.Classes.objects.values_list('id', 'title'),</span></div><div class="line">        <span class="comment">#                       attrs=&#123;'class': 'form-control'&#125;)</span></div><div class="line">        <span class="comment"># choice 是应用于单选 value_list 获取的就是列表中有元组</span></div><div class="line">        <span class="comment"># 注意此处有bug 添加班级后在这里没有新添加的班级，下面进行修复</span></div><div class="line"></div><div class="line">        <span class="comment"># choices=models.Classes.objects.values_list('id', 'title'),</span></div><div class="line">        widget=widgets.Select(</div><div class="line">            attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control'</span>&#125;)</div><div class="line">    )</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">        super(StudentForm, self).__init__(*args, **kwargs)</div><div class="line">        self.fields[<span class="string">'cls_id'</span>].widget.choices = models.Classes.objects.values_list(<span class="string">'id'</span>, <span class="string">'title'</span>)  <span class="comment"># 动态查询</span></div><div class="line">        <span class="comment"># 注意单选的时候用的而是widget.choice</span></div><div class="line">        <span class="comment"># 后面的多选没有用</span></div></pre></td></tr></table></figure>
<p><strong>2.2 前端处理</strong></p>
<ul>
<li>有外键的可以直接点出来   <code>row.cls.title</code></li>
</ul>
<p>学生列表<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>学生列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/add_student/"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">        &#123;% for row in stu_list %&#125;</div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">                &#123;&#123; row.name &#125;&#125;-&#123;&#123; row.email &#125;&#125;-&#123;&#123; row.age &#125;&#125;-&#123;&#123; row.cls_id &#125;&#125;-&#123;&#123; row.cls.title &#125;&#125;</div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/edit_student/&#123;&#123; row.id &#125;&#125;"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        &#123;% endfor %&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>添加学生，标签通过后台生成<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>添加学生<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/add_student/"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></div><div class="line">        &#123;% csrf_token %&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">            姓名：&#123;&#123; obj.name &#125;&#125; &#123;&#123; obj.errors.name.0 &#125;&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">           邮箱： &#123;&#123; obj.email &#125;&#125; &#123;&#123; obj.errors.email.0 &#125;&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">           年龄： &#123;&#123; obj.age &#125;&#125; &#123;&#123; obj.errors.age.0 &#125;&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">           班级 &#123;&#123; obj.cls_id &#125;&#125; &#123;&#123; obj.errors.cls_id.0 &#125;&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>编辑学生</p>
<ul>
<li>通过student_list 中获取了row.id </li>
<li>row.id 传递到后台</li>
<li>initial接收的是字典对象</li>
<li>正好values获取的是字典对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_student</span><span class="params">(request,nid)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    获取编辑学生的的信息并展现在输入框中 使用initial</div><div class="line">    :param request:</div><div class="line">    :param nid:</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        row = models.Students.objects.filter(id=nid).values(</div><div class="line">            <span class="string">'name'</span>,<span class="string">'email'</span>,<span class="string">'age'</span>,<span class="string">'cls_id'</span></div><div class="line">        ).first()  <span class="comment"># 使用valuse和first获取的是字典对象</span></div><div class="line">        obj = StudentForm(initial=row)  <span class="comment"># row接收的是字典对象</span></div><div class="line">        <span class="keyword">return</span> render(request,<span class="string">'edit_student.html'</span>,&#123;<span class="string">'nid'</span>:nid,<span class="string">'obj'</span>:obj&#125;)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        obj = StudentForm(request.POST)</div><div class="line">        <span class="keyword">if</span> obj.is_valid():</div><div class="line">            models.Students.objects.filter(id=nid).update(**obj.cleaned_data)</div><div class="line">            <span class="keyword">return</span> redirect(<span class="string">'/student_list/'</span>)</div><div class="line">        <span class="keyword">return</span> render(request,<span class="string">'edit_student.html'</span>,&#123;<span class="string">'obj'</span>:obj&#125;)</div></pre></td></tr></table></figure>
<p>前端</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/plugins/bootstrap-3.3.7-dist/css/bootstrap.css"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width: 500px; margin: 80px auto;"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"/edit_student/&#123;&#123; nid &#125;&#125;/"</span>&gt;</span></div><div class="line">            &#123;% csrf_token %&#125;</div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"exampleInputEmail1"</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">                &#123;&#123; obj.name &#125;&#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"exampleInputPassword1"</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">                &#123;&#123; obj.email &#125;&#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">             <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"exampleInputPassword1"</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">                &#123;&#123; obj.age &#125;&#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">             <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"exampleInputPassword1"</span>&gt;</span>班级<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">                &#123;&#123; obj.cls_id &#125;&#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="3-教师管理"><a href="#3-教师管理" class="headerlink" title="3 教师管理"></a>3 教师管理</h4><p><strong>form的执行过程：</strong></p>
<pre><code>1.找到所有的的字段 tname xx(这些都是静态字段)
2.把字段放到self.fields中{}是字典的形式
3.程序从上到下执行，启动后从数据库获取一次数据，然后就不变了，导致数据不能动态刷新
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">teacher_list</span><span class="params">(request)</span>:</span></div><div class="line">    tea_list = models.Teacher.objects.all()</div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'teacher_list.html'</span>, &#123;<span class="string">'tea_list'</span>: tea_list&#125;)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TeacherForm</span><span class="params">(Form)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    form的执行过程：</div><div class="line">    1.找到所有的的字段 tname xx(这些都是静态字段)</div><div class="line">    2.把字段放到self.fields中&#123;&#125;是字典的形式</div><div class="line">    3.程序从上到下执行，启动后从数据库获取一次数据，然后就不变了，导致数据不能动态刷新</div><div class="line"></div><div class="line">    """</div><div class="line">    tname = fields.CharField(min_length=<span class="number">2</span>)</div><div class="line">    xx = fields.MultipleChoiceField(</div><div class="line">        <span class="comment"># choice=models.Classes.objects.values_list('id', 'title'),  # 启动的时候查询</span></div><div class="line">        widget=widgets.SelectMultiple</div><div class="line">    )</div><div class="line"></div><div class="line">    <span class="string">"""</span></div><div class="line">    自己重写的方法</div><div class="line">    1.从self.fields的字典中找xx,然后找xx的choice，choice=[(),()]的形式</div><div class="line">    2.源码中会循环所有的字段，把有Field的加入self。Fields中，因为都是继承Fields</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></div><div class="line">        super(TeacherForm, self).__init__(*args, **kwargs)</div><div class="line">        self.fields[<span class="string">'xx'</span>].choices = models.Classes.objects.values_list(<span class="string">'id'</span>, <span class="string">'title'</span>)  <span class="comment"># 动态查询 多选的时候不用widget</span></div></pre></td></tr></table></figure>
<p><strong>添加老师</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_teacher</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        obj = TeacherForm()</div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'add_teacher.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        obj = TeacherForm(request.POST)</div><div class="line">        <span class="keyword">if</span> obj.is_valid():</div><div class="line">            xx = obj.cleaned_data.pop(<span class="string">'xx'</span>) <span class="comment"># 把验证通过的数据删除班级ID的信息 只留下教师表中的信息</span></div><div class="line">            row = models.Teacher.objects.create(**obj.cleaned_data) <span class="comment"># 向教师表添加数据 row代表教师表的对象</span></div><div class="line">            row.c2t.add(*xx)  <span class="comment"># [1,2] 通过教师表 向ManyTomany的第三张表中添加数据 班级ID是列表的形式 用*接收</span></div><div class="line">            <span class="keyword">return</span> redirect(<span class="string">'/teacher_list/'</span>)</div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'add_teacher.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div></pre></td></tr></table></figure>
<p><strong>编辑老师</strong></p>
<p>打开的时候有默认值， obj = TeacherForm(initial={‘tname’: row.tname, ‘xx’: id_list})  # 显示的默认值 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_teacher</span><span class="params">(request, nid)</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        row = models.Teacher.objects.filter(id=nid).first()</div><div class="line">        class_ids = row.c2t.values_list(<span class="string">'id'</span>)</div><div class="line">        print(class_ids)</div><div class="line">        <span class="comment"># for</span></div><div class="line">        <span class="comment"># 可以用for循环把class_ids中取出来</span></div><div class="line">        <span class="comment"># id_list =[]</span></div><div class="line">        <span class="comment"># for i in class_ids:</span></div><div class="line">        <span class="comment">#     id_list.append(i[0]) # calss_ids是[(1,),(2)]</span></div><div class="line">        <span class="comment"># print(id_list)</span></div><div class="line">        </div><div class="line">        <span class="comment"># zip + 三元运算</span></div><div class="line">        <span class="comment"># list(zip(*class_ids))[0]   #&lt;QuerySet [(1,), (2,)]&gt;</span></div><div class="line">        id_list = list(zip(*class_ids))[<span class="number">0</span>] <span class="keyword">if</span> list(zip(*class_ids)) <span class="keyword">else</span> []  <span class="comment"># 可能为空的情况</span></div><div class="line">        obj = TeacherForm(initial=&#123;<span class="string">'tname'</span>: row.tname, <span class="string">'xx'</span>: id_list&#125;)  <span class="comment"># 显示的默认值  xx是班级列表[1,2,3]</span></div><div class="line">        <span class="keyword">return</span> render(request, <span class="string">'edit_teacher.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</div></pre></td></tr></table></figure>
<p>生成标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>编辑老师<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></div><div class="line">       教师姓名 <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; obj.tname &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        任教班级<span class="tag">&lt;<span class="name">p</span>&gt;</span> &#123;&#123; obj.xx &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>总结</strong></p>
<p>Select框：</p>
<p>单选：单选是用CharField IntegerField 和Select搭配<br>      ChoiceField也是用于单选框，但是choice写在外面</p>
<pre><code>cls_id = fields.IntegerField(
    # widget=widgets.Select(choices=[(1,&apos;上海&apos;),(2,&apos;北京&apos;)])
    widget=widgets.Select(choices=models.Classes.objects.values_list(&apos;id&apos;,&apos;title&apos;),attrs={&apos;class&apos;: &apos;form-control&apos;})
)

cls_id = fields.ChoiceField(
    choices=models.Classes.objects.values_list(&apos;id&apos;,&apos;title&apos;),
    widget=widgets.Select(attrs={&apos;class&apos;: &apos;form-control&apos;})
)


obj = FooForm({&apos;cls_id&apos;:1})
</code></pre><p>多选：</p>
<p>多选只能用MultipleChoiceField ，且choices放在外面。最后重写init方法后就不用了</p>
<pre><code>xx = fields.MultipleChoiceField(
    choices=models.Classes.objects.values_list(&apos;id&apos;,&apos;title&apos;),
    widget=widgets.SelectMultiple
)

obj = FooForm({&apos;cls_id&apos;:[1,2,3]})
</code></pre><h3 id="通过Bootstrap进行界面美化"><a href="#通过Bootstrap进行界面美化" class="headerlink" title="通过Bootstrap进行界面美化"></a>通过Bootstrap进行界面美化</h3><p>bootstrap 的关键是给相应的标签添加class属性</p>
<p>如：添加form-control<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">    测试：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span> &#123;# 使用bootstrap #&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>对于自己生成的标签，是通过Form组件的插件添加属性的 <strong>widgets</strong></p>
<p>attrs后面对应的是字典类型<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">class StudentForm(Form):</div><div class="line">    name = fields.CharField(</div><div class="line">        min_length=2,</div><div class="line">        max_length=6,</div><div class="line">        widget = widgets.TextInput(attrs=&#123;'class':'form-control'&#125;)  # 给输入框添加属性</div><div class="line">    )</div><div class="line">    email = fields.EmailField(</div><div class="line">        widget=widgets.TextInput(attrs=&#123;'class': 'form-control'&#125;)  # 给输入框添加属性</div><div class="line">    )</div><div class="line">    age = fields.IntegerField(</div><div class="line">        min_value=18, max_value=100,</div><div class="line">        widget = widgets.TextInput(attrs=&#123;'class': 'form-control'&#125;)  # 给输入框添加属性</div><div class="line">    )</div><div class="line">    cls_id = fields.IntegerField(</div><div class="line">        # widget = widgets.Select(choices=[(1,'上海'),(1,'北京')])  # choices = 列表的内部是元组的形式</div><div class="line">        widget=widgets.Select(choices=models.Classes.objects.values_list('id', 'title'),attrs=&#123;'class': 'form-control'&#125;)</div><div class="line">        # choice 是应用于单选 value_list 获取的就是列表中有元组</div><div class="line">        # 注意此处有bug 添加班级后在这里没有新添加的班级，下面进行修复</div><div class="line">    )</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li></ul>

      
        
	<div id="comment">
	
	<!-- 多说评论框 start -->
	 <div class="ds-thread" data-thread-key="/2017/07/03/Django Form组件/" data-title="Django Form组件" data-url="https://github.com/ythzx/ythzx.github.io/2017/07/03/Django Form组件/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"ythzx"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0] 
	     || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
	  </script>
	<!-- 多说公共JS代码 end -->
	
	</div>
	<link rel="stylesheet" href="/css/comment.css">


      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/07/07/JSONP 技术/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          JSONP的原理及应用
        
      </div>
    </a>
  
  
    <a href="/2017/07/03/Django 安全机制/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">Django 安全机制</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
      <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、Form验证"><span class="nav-number">1.</span> <span class="nav-text">一、Form验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、From添加标签"><span class="nav-number">2.</span> <span class="nav-text">二、From添加标签</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-自己在前端写标签"><span class="nav-number">2.1.</span> <span class="nav-text">1 自己在前端写标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Form在前端生成标签"><span class="nav-number">2.2.</span> <span class="nav-text">2 Form在前端生成标签</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、Form保留返回值"><span class="nav-number">3.</span> <span class="nav-text">三、Form保留返回值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ajax保留返回值"><span class="nav-number">4.</span> <span class="nav-text">ajax保留返回值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-后台代码"><span class="nav-number">4.1.</span> <span class="nav-text">1 后台代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-前端代码"><span class="nav-number">4.2.</span> <span class="nav-text">2 前端代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、使用form实现学生、班级、教师管理"><span class="nav-number">5.</span> <span class="nav-text">四、使用form实现学生、班级、教师管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-班级管理"><span class="nav-number">5.1.</span> <span class="nav-text">1 班级管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-学生管理"><span class="nav-number">5.2.</span> <span class="nav-text">2 学生管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-教师管理"><span class="nav-number">5.3.</span> <span class="nav-text">3 教师管理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过Bootstrap进行界面美化"><span class="nav-number">6.</span> <span class="nav-text">通过Bootstrap进行界面美化</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2018 Peter&#39;s Blog Center All Rights Reserved.
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>






<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?93b40df12317201527431272f20ac28a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
  

  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


  <script type="text/javascript" color="33,33,33" zindex="-1" opacity="1" count="80" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
