<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ajax的原理及django上传组件 | Peter&#39;s Blog Center</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="Django" />
  
  
  
  
  <meta name="description" content="Ajax的原理及Django上传组件Ajax的原理">
<meta property="og:type" content="article">
<meta property="og:title" content="Ajax的原理及Django上传组件">
<meta property="og:url" content="https://github.com/ythzx/ythzx.github.io/2017/07/09/Ajax的原理及Django上传/index.html">
<meta property="og:site_name" content="Peter's Blog Center">
<meta property="og:description" content="Ajax的原理及Django上传组件Ajax的原理">
<meta property="og:image" content="http://images2015.cnblogs.com/blog/658994/201707/658994-20170712110258900-1417369227.jpg">
<meta property="og:updated_time" content="2017-08-02T11:32:46.113Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ajax的原理及Django上传组件">
<meta name="twitter:description" content="Ajax的原理及Django上传组件Ajax的原理">
<meta name="twitter:image" content="http://images2015.cnblogs.com/blog/658994/201707/658994-20170712110258900-1417369227.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Peter&#39;s Blog Center" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >
  <link rel="stylesheet" href="/css/hiero.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  <header id="allheader" class="site-header" role="banner">
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Peter&#39;s Blog Center" rel="home"> Peter&#39;s Blog Center </a>
            
          </h1>

          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>
            <div class="clearfix sf-menu">

              <ul id="main-nav" class="nmenu sf-js-enabled">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">首页</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">归档</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/categories">分类</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/tags">标签</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">关于</a> </li>
                    
              </ul>
            </div>
          </nav>


      </div>
  </div>
</header>




  <div id="container" style='background: rgba(255,255,255,0.5);'>
    <div id="wrap" style='background: rgba(255,255,255,0.5);'>
            
      <div id="content" class="outer" style='background: rgba(255,255,255,0.5);'>
        
          <section id="main" style="float:none;"><article id="post-Ajax的原理及Django上传" style="width: 66%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Ajax的原理及Django上传组件
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	Posted on <a href="/2017/07/09/Ajax的原理及Django上传/" class="article-date">
	  <time datetime="2017-07-09T04:36:25.864Z" itemprop="datePublished">七月 9, 2017</time>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Ajax的原理及Django上传组件"><a href="#Ajax的原理及Django上传组件" class="headerlink" title="Ajax的原理及Django上传组件"></a>Ajax的原理及Django上传组件</h1><h2 id="Ajax的原理"><a href="#Ajax的原理" class="headerlink" title="Ajax的原理"></a>Ajax的原理</h2><a id="more"></a>
<p>ajax 是异步JavaScript和xml</p>
<p>ajax就是向后台提交数据但是不刷新页面</p>
<h3 id="原生Ajax-XMLHttprequest"><a href="#原生Ajax-XMLHttprequest" class="headerlink" title="原生Ajax XMLHttprequest"></a>原生Ajax XMLHttprequest</h3><ul>
<li>创建一个XMLHttprequest对象</li>
<li>回调函数onreadystatechange 对应jQuery中的success</li>
<li>状态值是不断变化的，4代表完成，已经接收到全部响应数据；</li>
<li>open是创建请求</li>
<li>send是发送数据</li>
</ul>
<p><strong>XMLHttprequest对象的主要方法:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">a. void open(String method,String url,Boolen async)</div><div class="line">   用于创建请求</div><div class="line">    </div><div class="line">   参数：</div><div class="line">       method： 请求方式（字符串类型），如：POST、GET、DELETE...</div><div class="line">       url：    要请求的地址（字符串类型）</div><div class="line">       async：  是否异步（布尔类型）</div><div class="line"> </div><div class="line">b. void send(String body)</div><div class="line">    用于发送请求</div><div class="line"> </div><div class="line">    参数：</div><div class="line">        body： 要发送的数据（字符串类型）</div><div class="line"> </div><div class="line">c. void setRequestHeader(String header,String value)</div><div class="line">    用于设置请求头</div><div class="line"> </div><div class="line">    参数：</div><div class="line">        header： 请求头的key（字符串类型）</div><div class="line">        vlaue：  请求头的value（字符串类型）</div><div class="line"> </div><div class="line">d. String getAllResponseHeaders()</div><div class="line">    获取所有响应头</div><div class="line"> </div><div class="line">    返回值：</div><div class="line">        响应头数据（字符串类型）</div><div class="line"> </div><div class="line">e. String getResponseHeader(String header)</div><div class="line">    获取响应头中指定header的值</div><div class="line"> </div><div class="line">    参数：</div><div class="line">        header： 响应头的key（字符串类型）</div><div class="line"> </div><div class="line">    返回值：</div><div class="line">        响应头中指定的header对应的值</div><div class="line"> </div><div class="line">f. void abort()</div><div class="line"> </div><div class="line">    终止请求</div></pre></td></tr></table></figure></p>
<p><strong>XMLHttprequest的主要属性</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">a. Number readyState</div><div class="line">   状态值（整数）</div><div class="line"> </div><div class="line">   详细：</div><div class="line">      0-未初始化，尚未调用open()方法；</div><div class="line">      1-启动，调用了open()方法，未调用send()方法；</div><div class="line">      2-发送，已经调用了send()方法，未接收到响应；</div><div class="line">      3-接收，已经接收到部分响应数据；</div><div class="line">      4-完成，已经接收到全部响应数据；</div><div class="line"> </div><div class="line">b. Function onreadystatechange</div><div class="line">   当readyState的值改变时自动触发执行其对应的函数（回调函数）</div><div class="line"> </div><div class="line">c. String responseText</div><div class="line">   服务器返回的数据（字符串类型）</div><div class="line"> </div><div class="line">d. XmlDocument responseXML</div><div class="line">   服务器返回的数据（Xml对象）</div><div class="line"> </div><div class="line">e. Number states</div><div class="line">   状态码（整数），如：200、404...</div><div class="line"> </div><div class="line">f. String statesText</div><div class="line">   状态文本（字符串），如：OK、NotFound..</div></pre></td></tr></table></figure>
<h4 id="GET-请求"><a href="#GET-请求" class="headerlink" title="GET 请求"></a>GET 请求</h4><p>下面是通过GTE在URL中发用的数据<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"btn2"</span> <span class="attr">value</span>=<span class="string">"原生 Ajax"</span> <span class="attr">onclick</span>=<span class="string">"add2();"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">  function add2() &#123;</div><div class="line">            var xhr = new XMLHttpRequest(); //创建一个XMLHttpRequest对象</div><div class="line">            xhr.onreadystatechange = function () &#123;</div><div class="line">                //回调函数  状态值是4的时候代表数据返回成功</div><div class="line">                if(xhr.readyState==4)&#123;</div><div class="line">                    alert(xhr.responseText); // 服务器返回的数据</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">            xhr.open('GET','/add2/?i1=1&amp;i2=3'); // 第一个参数是method 第二个是URL 第三个是默认异步</div><div class="line">            xhr.send();</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add2</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        i1 =int(request.GET.get(<span class="string">'i1'</span>))</div><div class="line">        i2 =int(request.GET.get(<span class="string">'i2'</span>))</div><div class="line">        print(<span class="string">'add2'</span>)</div><div class="line">        <span class="keyword">return</span> HttpResponse(i1+i2)</div></pre></td></tr></table></figure>
<h4 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h4><p>POST请求的内容需要放到请求体中发送，而且需要设置请求头</p>
<p><strong>1 没有设置请求头的情况</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">	function add2() &#123;</div><div class="line">           var xhr = new XMLHttpRequest(); //创建一个XMLHttpRequest对象</div><div class="line">           xhr.onreadystatechange = function () &#123;</div><div class="line">               //回调函数  状态码是4的时候代表数据返回成功</div><div class="line">               if(xhr.readyState==4)&#123;</div><div class="line">                   alert(xhr.responseText); // 服务器返回的数据</div><div class="line">               &#125;</div><div class="line">           &#125;;</div><div class="line">           xhr.open('POST','/add2/'); // 第一个参数是method 第二个是URL 第三个是默认异步(不用写)</div><div class="line">           xhr.send('i1=1&amp;i2=3'); //发送的内容放到请求体中</div><div class="line">       &#125;</div><div class="line">   <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在后台从request.POST中获取不到数据，数据存在request.body中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add2</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">        i1 =int(request.GET.get(<span class="string">'i1'</span>))</div><div class="line">        i2 =int(request.GET.get(<span class="string">'i2'</span>))</div><div class="line">        print(<span class="string">'add2'</span>)</div><div class="line">        <span class="keyword">return</span> HttpResponse(i1+i2)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        print(request.POST)</div><div class="line">        print(request.body)</div><div class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">"..."</span>)</div></pre></td></tr></table></figure>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;QueryDict: &#123;&#125;&gt;  post中没有数据</div><div class="line">b&apos;i1=1&amp;i2=3&apos;  body总的数据</div></pre></td></tr></table></figure></p>
<p><strong>2 设置请求头</strong></p>
<ul>
<li>xhr.setRequestHeader(‘Content-Type’,’application/x-www-form-urlencoded’);</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var xhr = new XMLHttpRequest(); //创建一个XMLHttpRequest对象</div><div class="line">xhr.onreadystatechange = function () &#123;</div><div class="line">    //回调函数  状态码是4的时候代表数据返回成功</div><div class="line">    if(xhr.readyState==4)&#123;</div><div class="line">        alert(xhr.responseText); // 服务器返回的数据</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">xhr.open('POST','/add2/'); // 第一个参数是method 第二个是URL 第三个是默认异步</div><div class="line">xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');  //添加请求头</div><div class="line">xhr.send('i1=1&amp;i2=3');</div></pre></td></tr></table></figure>
<h3 id="jQueryAjax"><a href="#jQueryAjax" class="headerlink" title="jQueryAjax"></a>jQueryAjax</h3><p>jQuery本身是没有ajax的，是封装了原生的ajax</p>
<p>使用jQuery的ajax的计算器<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"i1"</span>&gt;</span></div><div class="line">    +</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"i2"</span>&gt;</span></div><div class="line">    =</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"i3"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"btn1"</span> <span class="attr">value</span>=<span class="string">"jQuery Ajax"</span> <span class="attr">onclick</span>=<span class="string">"add1();"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">        function add1() &#123;</div><div class="line">            $.ajax(&#123;</div><div class="line">                url:'/add1/',</div><div class="line">                type:'POST',</div><div class="line">                data:&#123;</div><div class="line">                    'i1':$('#i1').val(),</div><div class="line">                    'i2':$('#i2').val(),</div><div class="line">                &#125;,</div><div class="line">                success:function (arg) &#123;</div><div class="line">                    $('#i3').val(arg)</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add1</span><span class="params">(request)</span>:</span></div><div class="line">    a1 = int(request.POST.get(<span class="string">'i1'</span>))</div><div class="line">    a2 = int(request.POST.get(<span class="string">'i2'</span>))</div><div class="line">    <span class="keyword">return</span> HttpResponse(a1+a2)</div></pre></td></tr></table></figure>
<h3 id="伪Ajax，非XMLHttprequest"><a href="#伪Ajax，非XMLHttprequest" class="headerlink" title="伪Ajax，非XMLHttprequest"></a>伪Ajax，非XMLHttprequest</h3><p>iframe标签具有不刷新打开页面的功能</p>
<p>结合Form发送，form设置成通过iframe进行发送数据。</p>
<p>关键点是target</p>
<p><strong>1 iframe的应用</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"tex1"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"查看"</span> <span class="attr">onclick</span>=<span class="string">"changeScr();"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">"ifr"</span> <span class="attr">style</span>=<span class="string">"width: 1000px;height: 2000px"</span> <span class="attr">src</span>=<span class="string">"https://www.baidu.com"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">        function changeScr() &#123;</div><div class="line">            var inp = document.getElementById('tex1').value;  //value 获取文本中的内容</div><div class="line">            document.getElementById('ifr').src=inp;  // 找到iframe标签并设置src属性</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>2 iframe结合form</strong></p>
<p>target是iframe 的name属性的名字，这样form就会通过iframe进行发送</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/fake_ajax/"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">id</span>=<span class="string">"f1"</span> <span class="attr">target</span>=<span class="string">"ifrname"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">"ifrname"</span> <span class="attr">id</span>=<span class="string">"ifr"</span> &gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>3 伪ajax的回调函数</strong></p>
<p>使用onload，在iframe加载完后就代表数据发送回来了</p>
<ul>
<li>把iframe的样式隐藏display none</li>
<li>使用js提交表单，否则onload会是未定义</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;form action="/fake_ajax/" method="POST" id="f1" target="ifrname"&gt;</div><div class="line">    &lt;iframe name="ifrname" id="ifr" style="display: none"&gt;&lt;/iframe&gt;</div><div class="line">    &lt;input type="text" name="user"&gt;</div><div class="line">    &lt;a onclick="submitForm();"&gt;提交&lt;/a&gt;</div><div class="line">&lt;/form&gt;</div><div class="line">&lt;script&gt;</div><div class="line">    function submitForm() &#123;</div><div class="line">        document.getElementById('ifr').onload = loadIframe;  // 绑定事件后执行函数</div><div class="line">        document.getElementById('f1').submit();  //js提交表单</div><div class="line">    &#125;</div><div class="line">    //回调函数</div><div class="line">    function loadIframe() &#123;</div><div class="line">        alert(123);</div><div class="line">&#123;#        var content = document.getElementById('ifr').contentWindow.document.body.innerText;#&#125;</div><div class="line">&#123;#        alert(content);#&#125;</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p><strong>4 获取iframe中的内容</strong></p>
<p>iframe 实际是在当前页面嵌套了一个页面，存放在body中。<br>要进入，就要获取这个对象。用<strong>contentWindow</strong>，进入iframe的对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">submitForm</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'ifr'</span>).onload = loadIframe;  <span class="comment">// 绑定事件后执行函数</span></div><div class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'f1'</span>).submit();  <span class="comment">//js提交表单</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">//回调函数</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">loadIframe</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> content = <span class="built_in">document</span>.getElementById(<span class="string">'ifr'</span>).contentWindow.document.body.innerText;</div><div class="line">        alert(content);<span class="comment">//</span></div><div class="line">    &#125;</div><div class="line">&lt;<span class="regexp">/script&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Ajax上传文件"><a href="#Ajax上传文件" class="headerlink" title="Ajax上传文件"></a>Ajax上传文件</h2><p>上面通过XMLHttpresquest发送的是字符串，下面发送的是文件，具体说是文件对象，包含发送的文件的信息。</p>
<h3 id="XMLHttpresquest"><a href="#XMLHttpresquest" class="headerlink" title="XMLHttpresquest"></a>XMLHttpresquest</h3><p>利用XMLHttpresquest发送数据，还需要一个formData对象，<br>用 <code>formData.append(&#39;k1&#39;,&#39;v1&#39;);</code>添加发送的数据</p>
<h4 id="原生"><a href="#原生" class="headerlink" title="原生"></a>原生</h4><p><strong>1 用formdata发送字符串</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>原生ajax上传文件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">"upload1();"</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">upload1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData(); <span class="comment">//用一个FormData对象发送</span></div><div class="line">            formData.append(<span class="string">'k1'</span>,<span class="string">'v1'</span>);</div><div class="line">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">            xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span>(xhr.readyState==<span class="number">4</span>)&#123;</div><div class="line">                    alert(xhr.responseText)</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">            xhr.open(<span class="string">'POST'</span>,<span class="string">'/upload/'</span>); <span class="comment">// 第一个参数是method 第二个是URL 第三个是默认异步</span></div><div class="line">            xhr.setRequestHeader(<span class="string">'Content-Type'</span>,<span class="string">'application/x-www-form-urlencoded'</span>); <span class="comment">//添加请求头</span></div><div class="line">            xhr.send(formData);  <span class="comment">//发送formData对象</span></div><div class="line">        &#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>后台获取的数据：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(request)</span>:</span></div><div class="line"><span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'upload.html'</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    print(request.POST)  <span class="comment"># 查看POST获取的信息</span></div><div class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'...'</span>)</div></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;QueryDict: &#123;&apos;------WebKitFormBoundaryyPbfiKT1zk4kFYTP\r\nContent-Disposition: form-data&apos;: [&apos;&apos;], &apos; name&apos;: [&apos;&quot;k1&quot;\r\n\r\nv1\r\n------WebKitFormBoundaryyPbfiKT1zk4kFYTP--\r\n&apos;]&#125;&gt;</div></pre></td></tr></table></figure></p>
<p><strong>1.1 formdata对象发送字符串</strong></p>
<p>上面的情况是加上了请求头，这是自己用原生的XMLHttpresponse发送数据的时候</p>
<p>而formdata能够自动处理发送的数据(字符串、文件)</p>
<p>formdata发送字符串在后台直接获取<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>原生ajax上传文件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">"upload1();"</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">upload1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData(); <span class="comment">//用一个FormData对象发送</span></div><div class="line">            formData.append(<span class="string">'k1'</span>,<span class="string">'v1'</span>);</div><div class="line">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">            xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span>(xhr.readyState==<span class="number">4</span>)&#123;</div><div class="line">                    alert(xhr.responseText)</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">            xhr.open(<span class="string">'POST'</span>,<span class="string">'/upload/'</span>); <span class="comment">// 第一个参数是method 第二个是URL 第三个是默认异步</span></div><div class="line">            xhr.send(formData);  <span class="comment">//发送formData对象</span></div><div class="line">        &#125;;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>后台获取的数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;QueryDict: &#123;&apos;k1&apos;: [&apos;v1&apos;]&#125;&gt;</div></pre></td></tr></table></figure></p>
<p><strong>2 formdata对象发送文件</strong></p>
<p><img src="http://images2015.cnblogs.com/blog/658994/201707/658994-20170712110258900-1417369227.jpg" alt=""></p>
<ul>
<li>创建FormData对象</li>
<li>添加要发送的文件对象的，是一个列表，包含文件的信息<code>document.getElementById(&#39;i1&#39;).files[0]</code></li>
<li>send(formdata) 最后发送的是formdata对象 </li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>原生ajax上传文件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"i1"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">"upload1();"</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">upload1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData(); <span class="comment">//用一个FormData对象发送</span></div><div class="line">            formData.append(<span class="string">'k1'</span>,<span class="string">'v1'</span>);</div><div class="line">            formData.append(<span class="string">'upload_file'</span>,<span class="built_in">document</span>.getElementById(<span class="string">'i1'</span>).files[<span class="number">0</span>]); <span class="comment">// 把文件对象的列表放到这里</span></div><div class="line">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">            xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span>(xhr.readyState==<span class="number">4</span>)&#123;</div><div class="line">                   <span class="keyword">var</span> file_path = xhr.responseText;</div><div class="line">                    alert(file_path)</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">            xhr.open(<span class="string">'POST'</span>,<span class="string">'/upload/'</span>); <span class="comment">// 第一个参数是method 第二个是URL 第三个是默认异步</span></div><div class="line">            xhr.send(formData);  <span class="comment">//发送formData对象</span></div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>后台</p>
<ul>
<li>获取文件对象file_obj,<code>request.FILES.get(&#39;upload_file&#39;)</code>,文件名和前端对应</li>
<li>这个文件对象打印出来的是文件的名字</li>
<li>文件对象中chunks()是存在内存中的。保存文件要从内存保存到本地</li>
<li>拼接文件路径</li>
<li>把文件的路径返回到前端</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(request)</span>:</span></div><div class="line"><span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'upload.html'</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    print(request.POST)</div><div class="line">    print(request.FILES)</div><div class="line">    file_obj = request.FILES.get(<span class="string">'upload_file'</span>)  <span class="comment"># 获取上传文件的对象,获取的是formdata对象的第一个参数名</span></div><div class="line">    print(file_obj) <span class="comment"># file_obj 是文件本身 打印出来的是文件的名字</span></div><div class="line">    print(<span class="string">"..."</span>)</div><div class="line">    print(file_obj.chunks())  <span class="comment"># 这个是内存中的 &lt;generator object InMemoryUploadedFile.chunks at 0x000000000461EF10&gt;</span></div><div class="line">    file_path = os.path.join(<span class="string">'static'</span>, file_obj.name)  <span class="comment"># 拼接路径 然后保存</span></div><div class="line">    print(file_path)</div><div class="line">    <span class="keyword">with</span> open(file_path, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</div><div class="line">        <span class="string">"""</span></div><div class="line">        打开文件</div><div class="line">        模式：wb 写入</div><div class="line">        一点点打开文件并写入</div><div class="line">        """</div><div class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> file_obj.chunks():  <span class="comment"># 这里是chunks()  写错了chunks</span></div><div class="line">            f.write(chunk)</div><div class="line">    <span class="keyword">return</span> HttpResponse(file_path)  <span class="comment"># 把文件的路径返回到前端</span></div></pre></td></tr></table></figure>
<p><strong>3 ajax上传图片并预览</strong></p>
<ul>
<li>返回上传文件的路径</li>
<li>路径加 / + file_path 进行拼接</li>
<li>动态创建img 添加src</li>
<li>找到div appendchild</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>原生ajax上传文件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"i1"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">"upload1();"</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container1"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">upload1</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData(); <span class="comment">//用一个FormData对象发送</span></div><div class="line">            formData.append(<span class="string">'k1'</span>,<span class="string">'v1'</span>);</div><div class="line">            formData.append(<span class="string">'upload_file'</span>,<span class="built_in">document</span>.getElementById(<span class="string">'i1'</span>).files[<span class="number">0</span>]); <span class="comment">// 把文件对象的列表放到这里</span></div><div class="line">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">            xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span>(xhr.readyState==<span class="number">4</span>)&#123;</div><div class="line">                   <span class="keyword">var</span> file_path = xhr.responseText;</div><div class="line">                   alert(file_path);</div><div class="line">                   <span class="keyword">var</span> tag = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);  <span class="comment">// 动态创建img标签</span></div><div class="line">                    tag.src =<span class="string">'/'</span>+ file_path; <span class="comment">// 静态文件路径的开头有 斜杠</span></div><div class="line">                    <span class="built_in">document</span>.getElementById(<span class="string">'container1'</span>).appendChild(tag); <span class="comment">// 把img 添加到container1</span></div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">            xhr.open(<span class="string">'POST'</span>,<span class="string">'/upload/'</span>); <span class="comment">// 第一个参数是method 第二个是URL 第三个是默认异步</span></div><div class="line">            xhr.send(formData);  <span class="comment">//发送formData对象</span></div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="使用jQuery"><a href="#使用jQuery" class="headerlink" title="使用jQuery"></a>使用jQuery</h4><p>jQuery内部也是用的XMLHttpresquest,也是用formdata，还需要告知jQuery不在请求头添加内容</p>
<p><code>contentType:false,processData:false,</code></p>
<p>否则遇到的错误是：<code>Uncaught TypeError: Illegal invocation</code></p>
<p><strong>DOM 对象和jQuery对象的转换</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">jQuery -&gt; DOM ：$(&apos;#i2&apos;)[0] # 取0就是第一个元素</div><div class="line">DOM -&gt; jQuery  : $(document.getElementById(&apos;i2&apos;))  #直接加$</div></pre></td></tr></table></figure></p>
<p><a href="http://www.cnblogs.com/Python666/p/6925517.html" target="_blank" rel="external">http://www.cnblogs.com/Python666/p/6925517.html</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>jQuery ajax上传文件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"i2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">"upload2();"</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">        function upload2() &#123;</div><div class="line">            var formData = new FormData(); //用一个FormData对象发送</div><div class="line">            formData.append('k1','v1');</div><div class="line">            &#123;# formData.append('upload_file',document.getElementById('i2').files[0]);#&#125;</div><div class="line">            formData.append('upload_file',$('#i2')[0].files[0]); // 使用jQuery获取文件对象</div><div class="line">            /*</div><div class="line">            DOM 对象和jQuery对象的转换</div><div class="line">            DOM -&gt; jQuery ：$('#i2')[0]</div><div class="line">            jQuery -&gt; DOM : $(document.getElementById('i2'))</div><div class="line">             */</div><div class="line">            $.ajax(&#123;</div><div class="line">                url:'/upload/',</div><div class="line">                type:'POST',</div><div class="line">                data:formData,</div><div class="line">                contentType:false,</div><div class="line">                processData:false,</div><div class="line">                success:function (arg) &#123;</div><div class="line">                    alert(arg);</div><div class="line">                    var tag = document.createElement('img');  // 动态创建img标签</div><div class="line">                    tag.src ='/'+ arg; // 返回值args就是文件路径  静态文件路径的开头有 斜杠</div><div class="line">                    &#123;#document.getElementById('container2').appendChild(tag); // 把img 添加到container1#&#125;</div><div class="line">                    $('#container2').append(tag); //使用js动态添加</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="伪Ajax"><a href="#伪Ajax" class="headerlink" title="伪Ajax"></a>伪Ajax</h3><p>伪Ajax上传的兼容性好，form上传的参数<code>enctype=&quot;multipart/form-data&quot;</code></p>
<ul>
<li>设置input标签的name为upload_file,后台获取name属性名-&gt; 获取文件对象</li>
<li>XMLHttprequest 是通过formData append中 与后台的获取文件对象的名字一致</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>伪ajax上传文件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"f1"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"/upload/"</span> <span class="attr">target</span>=<span class="string">"ifr"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">"ifr"</span> <span class="attr">name</span>=<span class="string">"ifr"</span> <span class="attr">style</span>=<span class="string">"display: none;"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"upload_file"</span>&gt;</span> &#123;# 后台获取name 获取文件对象  #&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">"upload3()"</span>&gt;</span>伪ajax上传<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">        function upload3() &#123;</div><div class="line">            document.getElementById('ifr').onload = loadFrame;</div><div class="line">            document.getElementById('f1').submit();//form通过js进行提交</div><div class="line">        &#125;</div><div class="line">        function loadFrame() &#123;</div><div class="line">            var content = document.getElementById('ifr').contentWindow.document.body.innerText;</div><div class="line">            &#123;#alert(content);// 返回的是文件的路径#&#125;</div><div class="line">            var tag = document.createElement('img');</div><div class="line">            tag.src = '/' + content;</div><div class="line">            $('#container3').append(tag);</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>好看的上传按钮，通常是把原来的input加上了透明度<code>opacity=0</code>,设置<code>zindex</code>,</p>
<p>在下面的一层加上好看的按钮 zindex的值小于input的</p>
<p>参考：<br><a href="http://www.cnblogs.com/wupeiqi/articles/5703697.html" target="_blank" rel="external">http://www.cnblogs.com/wupeiqi/articles/5703697.html</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li></ul>

      
        
	<div id="comment">
	
	<!-- 多说评论框 start -->
	 <div class="ds-thread" data-thread-key="/2017/07/09/Ajax的原理及Django上传/" data-title="Ajax的原理及Django上传组件" data-url="https://github.com/ythzx/ythzx.github.io/2017/07/09/Ajax的原理及Django上传/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"ythzx"};
	  (function() {
	    var ds = document.createElement('script');
	    ds.type = 'text/javascript';ds.async = true;
	    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	    ds.charset = 'UTF-8';
	    (document.getElementsByTagName('head')[0] 
	     || document.getElementsByTagName('body')[0]).appendChild(ds);
	  })();
	  </script>
	<!-- 多说公共JS代码 end -->
	
	</div>
	<link rel="stylesheet" href="/css/comment.css">


      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/07/09/Form组件的扩展 钩子/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          Form组件的验证流程及扩展(钩子)
        
      </div>
    </a>
  
  
    <a href="/2017/07/09/CORS的原理及应用/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">CORS的原理及应用</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
      <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Ajax的原理及Django上传组件"><span class="nav-number">1.</span> <span class="nav-text">Ajax的原理及Django上传组件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Ajax的原理"><span class="nav-number">1.1.</span> <span class="nav-text">Ajax的原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原生Ajax-XMLHttprequest"><span class="nav-number">1.1.1.</span> <span class="nav-text">原生Ajax XMLHttprequest</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GET-请求"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">GET 请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POST请求"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">POST请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jQueryAjax"><span class="nav-number">1.1.2.</span> <span class="nav-text">jQueryAjax</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#伪Ajax，非XMLHttprequest"><span class="nav-number">1.1.3.</span> <span class="nav-text">伪Ajax，非XMLHttprequest</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ajax上传文件"><span class="nav-number">1.2.</span> <span class="nav-text">Ajax上传文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#XMLHttpresquest"><span class="nav-number">1.2.1.</span> <span class="nav-text">XMLHttpresquest</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#原生"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">原生</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用jQuery"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">使用jQuery</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#伪Ajax"><span class="nav-number">1.2.2.</span> <span class="nav-text">伪Ajax</span></a></li></ol></li></ol></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2017 Peter&#39;s Blog Center All Rights Reserved.
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hiero" target="_blank">hiero</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var contentdiv = document.getElementById("content");

    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>






<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?93b40df12317201527431272f20ac28a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
  

  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


  <script type="text/javascript" color="33,33,33" zindex="-1" opacity="1" count="80" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
